<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>PowerQueue | power-queues API Docs - v2.0.0</title><meta name="description" content="Documentation for power-queues API Docs"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">power-queues API Docs - v2.0.0</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="" aria-current="page">PowerQueue</a></li></ul><h1>Class PowerQueue<code class="tsd-tag">Abstract</code></h1></div><section class="tsd-panel tsd-comment"><div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks">Remarks<a href="#remarks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><h3 id="key-design-points" class="tsd-anchor-link">Key design points<a href="#key-design-points" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Data structures</strong>
<ul>
<li>Ready queue: Redis <strong>LIST</strong> (RPUSH producers, LMOVE/RPOPLPUSH consumers).</li>
<li>Processing queue: Redis <strong>LIST</strong> (RIGHT push of reserved items).</li>
<li>Visibility timeouts: Redis <strong>ZSET</strong> (member = raw task string; score = deadline in seconds).</li>
<li>Delayed tasks: Redis <strong>ZSET</strong> (score = availableAt seconds).</li>
</ul>
</li>
<li><strong>Reservation</strong>
<ul>
<li>Prefers <code>LMOVE LEFT RIGHT</code> (Redis ≥ 6.2) with a Lua loop for batch pulls.</li>
<li>Falls back to <code>RPOPLPUSH</code> if LMOVE is unavailable.</li>
</ul>
</li>
<li><strong>Heartbeat</strong>
<ul>
<li>Periodically extends ZSET score before the deadline to keep the item invisible.</li>
</ul>
</li>
<li><strong>Retries</strong>
<ul>
<li>Exponential backoff with jitter, capped by <a href="#retrymaxsec" class="tsd-kind-property">retryMaxSec</a>.</li>
</ul>
</li>
<li><strong>Chain</strong>
<ul>
<li>On success, automatically enqueues to the next queue in <a href="../types/TaskChain.html#queues" class="tsd-kind-property">TaskChain.queues</a>.</li>
</ul>
</li>
</ul>
<p>Extend this class and override the virtual methods as needed:
<a href="#execute" class="tsd-kind-method">execute</a> (required), and optionally <a href="#beforeexecution" class="tsd-kind-method">beforeExecution</a>, <a href="#afterexecution" class="tsd-kind-method">afterExecution</a>,
<a href="#onretry" class="tsd-kind-method">onRetry</a>, <a href="#onerror" class="tsd-kind-method">onError</a>, <a href="#onfail" class="tsd-kind-method">onFail</a>, <a href="#onfatal" class="tsd-kind-method">onFatal</a>, <a href="#onsuccess" class="tsd-kind-method">onSuccess</a>,
<a href="#onchainsuccess" class="tsd-kind-method">onChainSuccess</a>, <a href="#beforeiterationexecution" class="tsd-kind-method">beforeIterationExecution</a>, <a href="#afteriterationexecution" class="tsd-kind-method">afterIterationExecution</a>,
<a href="#oniterationerror" class="tsd-kind-method">onIterationError</a>.</p>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example">Example<a href="#example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-6">class</span><span class="hl-1"> </span><span class="hl-7">ImageResizer</span><span class="hl-1"> </span><span class="hl-6">extends</span><span class="hl-1"> </span><span class="hl-7">PowerQueue</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">execute</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-7">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">TaskResult</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-3">// your business logic</span><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1"> { </span><span class="hl-5">resized:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">, </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-5">task</span><span class="hl-1">.</span><span class="hl-5">id</span><span class="hl-1"> };</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">worker</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">ImageResizer</span><span class="hl-1">(</span><span class="hl-5">redisClient</span><span class="hl-1">);</span><br/><span class="hl-5">worker</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&#39;img:resize&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since">Since<a href="#since" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div></div></section><section class="tsd-panel tsd-hierarchy" data-refl="27"><h4>Hierarchy</h4><ul class="tsd-hierarchy"><li class="tsd-hierarchy-item"><span class="tsd-signature-type">PowerRedis</span><ul class="tsd-hierarchy"><li class="tsd-hierarchy-item"><span class="tsd-hierarchy-target">PowerQueue</span></li></ul></li></ul></section><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L63">PowerQueue.ts:63</a></li></ul></aside><section class="tsd-panel-group tsd-index-group"><section class="tsd-panel tsd-index-panel"><details class="tsd-index-content tsd-accordion" open><summary class="tsd-accordion-summary tsd-index-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h5 class="tsd-index-heading uppercase">Index</h5></summary><div class="tsd-accordion-details"><section class="tsd-index-section"><h3 class="tsd-index-heading">Constructors</h3><div class="tsd-index-list"><a href="#constructor" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Constructor"><use href="../assets/icons.svg#icon-512"></use></svg><span>constructor</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Properties</h3><div class="tsd-index-list"><a href="#concurrency" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>concurrency</span></a>
<a href="#expirestatussec" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>expire<wbr/>Status<wbr/>Sec</span></a>
<a href="#iterationtimeout" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>iteration<wbr/>Timeout</span></a>
<a href="#maxattempts" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>max<wbr/>Attempts</span></a>
<a href="#portionlength" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>portion<wbr/>Length</span></a>
<a href="#retrybasesec" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>retry<wbr/>Base<wbr/>Sec</span></a>
<a href="#retrymaxsec" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>retry<wbr/>Max<wbr/>Sec</span></a>
<a href="#visibilitytimeoutsec" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>visibility<wbr/>Timeout<wbr/>Sec</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Methods - Acknowledgement</h3><div class="tsd-index-list"><a href="#ackprocessing" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>ack<wbr/>Processing</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Methods - Core Business Logic</h3><div class="tsd-index-list"><a href="#execute" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>execute</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Methods - Execution Loop</h3><div class="tsd-index-list"><a href="#iteration" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>iteration</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Methods - Lifecycle</h3><div class="tsd-index-list"><a href="#run" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>run</span></a>
<a href="#stop" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>stop</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Methods - Lifecycle Hooks</h3><div class="tsd-index-list"><a href="#afterexecution" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>after<wbr/>Execution</span></a>
<a href="#afteriterationexecution" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>after<wbr/>Iteration<wbr/>Execution</span></a>
<a href="#beforeexecution" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>before<wbr/>Execution</span></a>
<a href="#beforeiterationexecution" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>before<wbr/>Iteration<wbr/>Execution</span></a>
<a href="#onchainsuccess" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>on<wbr/>Chain<wbr/>Success</span></a>
<a href="#onerror" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>on<wbr/>Error</span></a>
<a href="#onfail" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>on<wbr/>Fail</span></a>
<a href="#onfatal" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>on<wbr/>Fatal</span></a>
<a href="#oniterationerror" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>on<wbr/>Iteration<wbr/>Error</span></a>
<a href="#onretry" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>on<wbr/>Retry</span></a>
<a href="#onsuccess" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>on<wbr/>Success</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Methods - Queue Production</h3><div class="tsd-index-list"><a href="#addtask" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>add<wbr/>Task</span></a>
<a href="#enqueue" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>enqueue</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Methods - Redis Key Helpers</h3><div class="tsd-index-list"><a href="#tokeystring" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>to<wbr/>Key<wbr/>String</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Methods - Reservation</h3><div class="tsd-index-list"><a href="#reservemany" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>reserve<wbr/>Many</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Methods - Scheduling &amp; Delays</h3><div class="tsd-index-list"><a href="#promotedelayed" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>promote<wbr/>Delayed</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Methods - Task Construction</h3><div class="tsd-index-list"><a href="#buildtask" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>build<wbr/>Task</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Methods - Time &amp; Visibility</h3><div class="tsd-index-list"><a href="#extendvisibility" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>extend<wbr/>Visibility</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Methods - Visibility &amp; Recovery</h3><div class="tsd-index-list"><a href="#requeueexpired" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>requeue<wbr/>Expired</span></a>
</div></section></div></details></section></section><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Constructors"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Constructors</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="constructor"><span>constructor</span><a href="#constructor" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="constructorpowerqueue"><span class="tsd-signature-keyword">new</span> <span class="tsd-kind-constructor-signature">PowerQueue</span><span class="tsd-signature-symbol">()</span><span class="tsd-signature-symbol">:</span> <a href="" class="tsd-signature-type tsd-kind-class">PowerQueue</a><a href="#constructorpowerqueue" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><h4 class="tsd-returns-title">Returns <a href="" class="tsd-signature-type tsd-kind-class">PowerQueue</a></h4><aside class="tsd-sources"><p>Inherited from PowerRedis.constructor</p></aside></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Properties"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Properties</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="concurrency"><code class="tsd-tag">Readonly</code><span>concurrency</span><a href="#concurrency" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><div class="tsd-signature"><span class="tsd-kind-property">concurrency</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 32</span></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L72">PowerQueue.ts:72</a></li></ul></aside></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="expirestatussec"><code class="tsd-tag">Readonly</code><span>expire<wbr/>Status<wbr/>Sec</span><a href="#expirestatussec" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><div class="tsd-signature"><span class="tsd-kind-property">expireStatusSec</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 300</span></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L70">PowerQueue.ts:70</a></li></ul></aside></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="iterationtimeout"><code class="tsd-tag">Readonly</code><span>iteration<wbr/>Timeout</span><a href="#iterationtimeout" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><div class="tsd-signature"><span class="tsd-kind-property">iterationTimeout</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 1000</span></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L68">PowerQueue.ts:68</a></li></ul></aside></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="maxattempts"><code class="tsd-tag">Readonly</code><span>max<wbr/>Attempts</span><a href="#maxattempts" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><div class="tsd-signature"><span class="tsd-kind-property">maxAttempts</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 1</span></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L71">PowerQueue.ts:71</a></li></ul></aside></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="portionlength"><code class="tsd-tag">Readonly</code><span>portion<wbr/>Length</span><a href="#portionlength" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><div class="tsd-signature"><span class="tsd-kind-property">portionLength</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 1000</span></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L69">PowerQueue.ts:69</a></li></ul></aside></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="retrybasesec"><code class="tsd-tag">Readonly</code><span>retry<wbr/>Base<wbr/>Sec</span><a href="#retrybasesec" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><div class="tsd-signature"><span class="tsd-kind-property">retryBaseSec</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 1</span></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L74">PowerQueue.ts:74</a></li></ul></aside></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="retrymaxsec"><code class="tsd-tag">Readonly</code><span>retry<wbr/>Max<wbr/>Sec</span><a href="#retrymaxsec" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><div class="tsd-signature"><span class="tsd-kind-property">retryMaxSec</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 3600</span></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L75">PowerQueue.ts:75</a></li></ul></aside></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="visibilitytimeoutsec"><code class="tsd-tag">Readonly</code><span>visibility<wbr/>Timeout<wbr/>Sec</span><a href="#visibilitytimeoutsec" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><div class="tsd-signature"><span class="tsd-kind-property">visibilityTimeoutSec</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 60</span></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L73">PowerQueue.ts:73</a></li></ul></aside></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Methods - Acknowledgement"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Methods - Acknowledgement</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="ackprocessing"><span>ack<wbr/>Processing</span><a href="#ackprocessing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="ackprocessing-1"><span class="tsd-kind-call-signature">ackProcessing</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">processing</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">processingVt</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">raw</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span><a href="#ackprocessing-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">processing</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Redis <strong>LIST</strong> key that holds in-flight (reserved) items for the queue.
Typically built with processingKey.</p>
</div></li><li><span><span class="tsd-kind-parameter">processingVt</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Redis <strong>ZSET</strong> key that tracks visibility deadlines for the same items.
Typically built with processingVtKey.</p>
</div></li><li><span><span class="tsd-kind-parameter">raw</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The <strong>exact serialized payload</strong> string that represents the reserved task.
Must match the member stored in both the list and the ZSET.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></h4><p><code>Promise&lt;void&gt;</code> - resolves after Redis confirms the transaction. No value is returned.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-1">Remarks<a href="#remarks-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>When a task is reserved, its serialized payload (the <strong>raw</strong> string) is placed into:</p>
<ul>
<li>the <em>processing</em> list (tracks in-flight items), and</li>
<li>the <em>processing:vt</em> ZSET (stores the visibility deadline).</li>
</ul>
<p>Calling <code>ackProcessing()</code> confirms the task finished and makes it eligible to be
permanently removed from both structures. The method:</p>
<ol>
<li>Verifies Redis connectivity,</li>
<li>Starts a <code>MULTI</code> transaction,</li>
<li>Enqueues <code>LREM processing 1 &lt;raw&gt;</code> and <code>ZREM processingVt &lt;raw&gt;</code>,</li>
<li>Executes <code>EXEC</code>.</li>
</ol>
<p>If the <em>raw</em> payload is already absent (e.g., duplicate ACK or a prior cleanup),
the operation is a <strong>no-op</strong>—Redis will simply report zero removals. Using
<code>LREM ... 1</code> ensures only a single list occurrence is removed, which is the
expected invariant for correctly managed processing items.</p>
<hr>
<h3 id="why-a-transaction" class="tsd-anchor-link">Why a transaction?<a href="#why-a-transaction" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Removing from the list and the ZSET in one <code>MULTI/EXEC</code> block minimizes race
windows and keeps the two data structures in sync. While Redis transactions are
not rollbacks in the RDBMS sense, grouping these commands ensures they execute
contiguously and reduces the chance of partial cleanup under concurrency.</p>
<p>Performance:</p>
<ul>
<li><code>LREM</code> is <code>O(n)</code> in the list length; <code>ZREM</code> is <code>O(log n)</code> in the ZSET size.</li>
<li>Using a single <code>MULTI/EXEC</code> round-trip is generally faster than executing
two independent calls.</li>
</ul>
<p>Security:</p>
<ul>
<li>Keys and the <code>raw</code> member come from internal, validated sources in this class.</li>
<li>Avoid passing untrusted strings directly into this method.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>Time: <code>O(n + log n)</code> (list removal + ZSET removal)</li>
<li>Space: <code>O(1)</code> client-side; Redis memory decreases by the removed member(s).</li>
</ul>
<p>Notes:</p>
<ul>
<li>This method intentionally does not remove the item from the <em>ready</em> list—
by design, acknowledged items should no longer exist there.</li>
<li>If duplicates were somehow inserted into the processing list, <code>LREM ... 1</code>
will remove only one instance. Consider auditing upstream logic if you
observe duplicates.</li>
</ul>
</div><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws">Throws<a href="#throws" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><code>&quot;Redis connection error.&quot;</code> if the client is not connected.</li>
<li>Any error propagated by the underlying Redis client during <code>MULTI/EXEC</code>.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-1">Example<a href="#example-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// After finishing a task:</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">raw</span><span class="hl-1"> = </span><span class="hl-9">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">); </span><span class="hl-3">// or PowerQueue.toPayload(task)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">processing</span><span class="hl-1">   = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">toKeyString</span><span class="hl-1">(</span><span class="hl-5">queueName</span><span class="hl-1">, </span><span class="hl-2">&#39;processing&#39;</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">processingVt</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">toKeyString</span><span class="hl-1">(</span><span class="hl-5">queueName</span><span class="hl-1">, </span><span class="hl-2">&#39;processing&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;vt&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">ackProcessing</span><span class="hl-1">(</span><span class="hl-5">processing</span><span class="hl-1">, </span><span class="hl-5">processingVt</span><span class="hl-1">, </span><span class="hl-5">raw</span><span class="hl-1">);</span><br/><span class="hl-3">// The task is now removed from both the processing list and its VT ZSET.</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-1">Since<a href="#since-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see">See<a href="#see" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>ack - High-level wrapper that looks up the raw payload and calls this method.</li>
<li><a href="#reservemany" class="tsd-kind-method">reserveMany</a> - Puts items into <code>processing</code> and <code>processing:vt</code>.</li>
<li><a href="#requeueexpired" class="tsd-kind-method">requeueExpired</a> - Moves unacknowledged, expired items back to ready.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L1669">PowerQueue.ts:1669</a></li></ul></aside></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Methods - Core Business Logic"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Methods - Core Business Logic</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="execute"><span>execute</span><a href="#execute" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="execute-1"><span class="tsd-kind-call-signature">execute</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">task</span><span class="tsd-signature-symbol">:</span> <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/TaskResult.html" class="tsd-signature-type tsd-kind-type-alias">TaskResult</a><span class="tsd-signature-symbol">&gt;</span><a href="#execute-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">task</span>: <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a></span><div class="tsd-comment tsd-typography"><p>A full <a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> object containing all necessary metadata
and the <code>payload</code> to be processed.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/TaskResult.html" class="tsd-signature-type tsd-kind-type-alias">TaskResult</a><span class="tsd-signature-symbol">&gt;</span></h4><p>A <code>Promise</code> resolving to a <a href="../types/TaskResult.html" class="tsd-kind-type-alias">TaskResult</a> - a plain object representing
the result of this operation.<br>
Returning <code>{}</code> is considered “success with no payload”.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-2">Remarks<a href="#remarks-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This is the <strong>primary method to override</strong> when extending <a href="#" class="tsd-kind-class">PowerQueue</a>.
Each subclass must implement its own version of <code>execute()</code> to perform
the actual work associated with a task (e.g., API call, image processing,
database operation, file transformation, etc.).</p>
<p>The default implementation here simply returns an <strong>empty object</strong> <code>{}</code>,
which serves as a no-op placeholder.</p>
<hr>
<h3 id="responsibilities" class="tsd-anchor-link">Responsibilities<a href="#responsibilities" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Receive a deserialized <a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> object.</li>
<li>Perform synchronous or asynchronous operations based on its payload.</li>
<li>Return a serializable <a href="../types/TaskResult.html" class="tsd-kind-type-alias">TaskResult</a> - typically an object containing
summary fields or output data.</li>
</ul>
<p>The return value is automatically passed to <a href="#afterexecution" class="tsd-kind-method">afterExecution</a>,
<a href="#onsuccess" class="tsd-kind-method">onSuccess</a>, and potentially <a href="#onchainsuccess" class="tsd-kind-method">onChainSuccess</a> if the task is
part of a chained workflow.</p>
<hr>
<h3 id="error-handling" class="tsd-anchor-link">Error handling<a href="#error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>If <code>execute()</code> throws or rejects, the error is caught internally by logic,
and retry/failure hooks (<code>onRetry</code>, <code>onError</code>, <code>onFail</code>, <code>onFatal</code>) are triggered.</li>
<li>If it resolves successfully, <a href="#afterexecution" class="tsd-kind-method">afterExecution</a> and <a href="#onsuccess" class="tsd-kind-method">onSuccess</a> run.</li>
</ul>
<hr>
<h3 id="best-practices" class="tsd-anchor-link">Best practices<a href="#best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Always return lightweight, serializable data structures (plain objects).</li>
<li>Avoid returning class instances or non-JSON-compatible types.</li>
<li>Keep long-running operations cancellable when possible.</li>
<li>Handle transient failures gracefully and let the retry system decide
on rescheduling.</li>
</ul>
<hr>
<h3 id="typical-use-cases" class="tsd-anchor-link">Typical use cases<a href="#typical-use-cases" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Example</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>HTTP worker</td>
<td>Fetch a remote API and return the parsed JSON.</td>
</tr>
<tr>
<td>Image worker</td>
<td>Resize or compress an image file.</td>
</tr>
<tr>
<td>Database job</td>
<td>Insert a record and return its ID.</td>
</tr>
<tr>
<td>Notification sender</td>
<td>Send an email/SMS and return delivery status.</td>
</tr>
</tbody>
</table>
<p>Performance:</p>
<ul>
<li>Runs concurrently up to <a href="#concurrency" class="tsd-kind-property">concurrency</a> per iteration.</li>
<li>Total throughput depends on operation latency and external resources.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>Time: depends on custom implementation.</li>
<li>Space: proportional to task payload and result data.</li>
</ul>
<p>Security:</p>
<ul>
<li>Sanitize and validate untrusted task data before executing.</li>
<li>Avoid side effects unless the queue guarantees idempotency.</li>
<li>Ensure sensitive data in results is masked if persisted.</li>
</ul>
</div><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-1">Throws<a href="#throws-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Any thrown error (synchronous or rejected promise) will trigger retry/error
handling through retry, <a href="#onerror" class="tsd-kind-method">onError</a>, and related hooks.</p>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-2">Example<a href="#example-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: simple addition worker</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">execute</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">TaskResult</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  const { </span><span class="hl-5">a</span><span class="hl-1">, </span><span class="hl-5">b</span><span class="hl-1"> } = task.payload;</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-5">a</span><span class="hl-1"> !== </span><span class="hl-2">&#39;number&#39;</span><span class="hl-1"> || </span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-5">b</span><span class="hl-1"> !== </span><span class="hl-2">&#39;number&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Invalid payload&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  return { </span><span class="hl-10">sum</span><span class="hl-1">: </span><span class="hl-5">a</span><span class="hl-1"> + </span><span class="hl-5">b</span><span class="hl-1"> };</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-3">Example<a href="#example-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: HTTP fetch worker</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">execute</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">TaskResult</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  const </span><span class="hl-5">res</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">.</span><span class="hl-5">payload</span><span class="hl-1">.</span><span class="hl-5">url</span><span class="hl-1">);</span><br/><span class="hl-1">  const </span><span class="hl-5">json</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">res</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">();</span><br/><span class="hl-1">  return { </span><span class="hl-10">status</span><span class="hl-1">: </span><span class="hl-5">res</span><span class="hl-1">.</span><span class="hl-5">status</span><span class="hl-1">, </span><span class="hl-10">data</span><span class="hl-1">: </span><span class="hl-5">json</span><span class="hl-1"> };</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-4">Example<a href="#example-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Default implementation (no operation)</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">execute</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">TaskResult</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  return {};</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-2">Since<a href="#since-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-1">See<a href="#see-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#beforeexecution" class="tsd-kind-method">beforeExecution</a> - Called immediately before this hook.</li>
<li><a href="#afterexecution" class="tsd-kind-method">afterExecution</a> - Runs right after this method resolves successfully.</li>
<li>logic - Internal pipeline that calls this function.</li>
<li><a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> | <a href="../types/TaskResult.html" class="tsd-kind-type-alias">TaskResult</a> - Data structures representing a queue item and its output.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L3126">PowerQueue.ts:3126</a></li></ul></aside></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Methods - Execution Loop"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Methods - Execution Loop</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="iteration"><span>iteration</span><a href="#iteration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="iteration-1"><span class="tsd-kind-call-signature">iteration</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">tasks</span><span class="tsd-signature-symbol">:</span> <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span><a href="#iteration-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">tasks</span>: <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">[]</span></span><div class="tsd-comment tsd-typography"><p>The list of tasks reserved for this iteration (typically from data).
They are first passed to <a href="#beforeiterationexecution" class="tsd-kind-method">beforeIterationExecution</a> which may change the list.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></h4><p><code>Promise&lt;void&gt;</code> - resolves after all tasks in this iteration have been processed
(including hooks), regardless of individual task outcomes (success/retry/fail).</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-3">Remarks<a href="#remarks-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The iteration pipeline is:</p>
<ol>
<li><strong>Pre-hook</strong> - <a href="#beforeiterationexecution" class="tsd-kind-method">beforeIterationExecution</a> can filter, reorder, enrich,
or otherwise transform the incoming <code>tasks</code>. The returned array becomes
<code>tasksProcessed</code>.</li>
<li><strong>Concurrent execution</strong> - Tasks are split into slices of size
<a href="#concurrency" class="tsd-kind-property">concurrency</a>. Each slice is executed in parallel via <code>Promise.all</code>,
where each task runs through the internal logic method
(which calls <a href="#beforeexecution" class="tsd-kind-method">beforeExecution</a> → <a href="#execute" class="tsd-kind-method">execute</a> → <a href="#afterexecution" class="tsd-kind-method">afterExecution</a>
and handles success/retry/failure, heartbeat, and ACK).</li>
<li><strong>Post-hook</strong> - <a href="#afteriterationexecution" class="tsd-kind-method">afterIterationExecution</a> receives the final
<code>tasksProcessed</code> and a parallel array of their <code>result</code> objects for
aggregate reporting, metrics, or cleanup.</li>
</ol>
<p>The method returns only when all slices in the current iteration complete.
It does <strong>not</strong> loop forever; the outer scheduling is handled by loop.</p>
<p>Performance:</p>
<ul>
<li>Concurrency is capped by <a href="#concurrency" class="tsd-kind-property">concurrency</a>; default is <code>32</code>.</li>
<li>Using slices avoids spawning unbounded promises and keeps memory predictable.</li>
<li>Heavy work should live inside <a href="#execute" class="tsd-kind-method">execute</a>; this wrapper adds minimal overhead.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>Time: roughly <code>O(n)</code> for <code>n = tasksProcessed.length</code>, with per-task cost
dominated by your business logic in <a href="#execute" class="tsd-kind-method">execute</a>.</li>
<li>Space: <code>O(n)</code> for the tasks array and their results. Concurrency limits
peak in-flight work to <code>concurrency</code>.</li>
</ul>
<p>Security:</p>
<ul>
<li>Task payloads are user/domain data; validate inside <a href="#execute" class="tsd-kind-method">execute</a>.</li>
<li>Hooks can sanitize/normalize input or enforce policies before running tasks.</li>
</ul>
</div><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-2">Throws<a href="#throws-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This method itself does not throw for individual task errors; those are handled
inside logic. It can throw if hooks reject (uncaught in this method),
but the surrounding loop places calls in try/catch and invokes
<a href="#oniterationerror" class="tsd-kind-method">onIterationError</a> on failures.</p>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-5">Example<a href="#example-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Inside the worker loop, after reserving tasks:</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">tasks</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">data</span><span class="hl-1">(</span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">);</span><br/><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">tasks</span><span class="hl-1">.</span><span class="hl-5">length</span><span class="hl-1"> &gt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">iteration</span><span class="hl-1">(</span><span class="hl-5">tasks</span><span class="hl-1">); </span><span class="hl-3">// runs tasks with concurrency limits</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-6">Example<a href="#example-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Customize hooks to sort tasks by priority before execution</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">beforeIterationExecution</span><span class="hl-1">(</span><span class="hl-5">tasks</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">[]): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">Task</span><span class="hl-1">[]&gt; {</span><br/><span class="hl-1">  return tasks.sort((</span><span class="hl-5">a</span><span class="hl-1">, b) =&gt; (b.payload.priority ?? </span><span class="hl-8">0</span><span class="hl-5">) -</span><span class="hl-1"> (a.payload.priority ?? </span><span class="hl-8">0</span><span class="hl-5">));</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">afterIterationExecution</span><span class="hl-1">(</span><span class="hl-5">tasks</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">[], </span><span class="hl-5">results</span><span class="hl-1">: </span><span class="hl-5">TaskResult</span><span class="hl-1">[]): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-3">// Aggregate metrics, log summary, emit events, etc.</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-3">Since<a href="#since-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-2">See<a href="#see-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#concurrency" class="tsd-kind-property">concurrency</a> - Maximum tasks processed in parallel.</li>
<li>logic - Per-task execution flow (success, retry, ack, heartbeat).</li>
<li><a href="#beforeiterationexecution" class="tsd-kind-method">beforeIterationExecution</a> | <a href="#afteriterationexecution" class="tsd-kind-method">afterIterationExecution</a> - Iteration hooks.</li>
<li>loop - Calls this method repeatedly as part of the worker lifecycle.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L2653">PowerQueue.ts:2653</a></li></ul></aside></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Methods - Lifecycle"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Methods - Lifecycle</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="run"><span>run</span><a href="#run" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="run-1"><span class="tsd-kind-call-signature">run</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">queueName</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">void</span><a href="#run-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">queueName</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Logical name of the queue to start (e.g., <code>&quot;emails&quot;</code>).</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">void</span></h4><p><code>void</code> - the processing loop is started asynchronously as a side effect.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-4">Remarks<a href="#remarks-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This method is the public entry point to begin processing a queue. It:</p>
<ol>
<li>Validates <code>queueName</code> (must be a non-empty string).</li>
<li>Looks up (or initializes) an internal runner flag for that queue.</li>
<li>Prevents concurrent starts (throws if already running).</li>
<li>Marks the queue as running and <strong>fire-and-forgets</strong> the main loop
(any top-level error from <code>loop()</code> is caught and flips the <code>running</code> flag to <code>false</code>).</li>
</ol>
<p>The loop itself repeatedly:</p>
<ul>
<li>Promotes due delayed jobs (<a href="#promotedelayed" class="tsd-kind-method">promoteDelayed</a>),</li>
<li>Requeues expired processing jobs (<a href="#requeueexpired" class="tsd-kind-method">requeueExpired</a>),</li>
<li>Reserves a batch from the ready list and executes them with concurrency controls
(see <a href="#iteration" class="tsd-kind-method">iteration</a> and <a href="#reservemany" class="tsd-kind-method">reserveMany</a>).</li>
</ul>
<p>Use <a href="#stop" class="tsd-kind-method">stop</a> to request a graceful stop. Stopping sets the <code>running</code> flag to <code>false</code>,
allowing the current iteration to finish naturally.</p>
<p>Performance:</p>
<ul>
<li><code>run()</code> is O(1); the heavy work is in the background loop.</li>
<li>The design supports multiple queues; each queue has its own runner flag.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>Time/space: O(1) for the <code>run()</code> call. Ongoing complexity is handled by loop.</li>
</ul>
<p>Security:</p>
<ul>
<li><code>queueName</code> should be a safe identifier (validated internally).</li>
<li>Keys derived from <code>queueName</code> are built via <a href="#tokeystring" class="tsd-kind-method">toKeyString</a> to enforce namespacing.</li>
</ul>
<p>Notes:</p>
<ul>
<li>The method intentionally does <strong>not</strong> <code>await</code> the loop; it starts asynchronously.</li>
<li>If <code>loop()</code> throws at the top level, the <code>.catch()</code> handler resets <code>running=false</code>
so a subsequent <code>run()</code> call can restart the queue.</li>
</ul>
</div><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-3">Throws<a href="#throws-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><code>&quot;Queue name is not valid.&quot;</code> if <code>queueName</code> is empty/invalid.</li>
<li><code>&quot;Queue &quot;&lt;name&gt;&quot; already started.&quot;</code> if a runner for this queue is already active.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-7">Example<a href="#example-7" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-6">class</span><span class="hl-1"> </span><span class="hl-7">EmailWorker</span><span class="hl-1"> </span><span class="hl-6">extends</span><span class="hl-1"> </span><span class="hl-7">PowerQueue</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">execute</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-7">Task</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">// ... send email ...</span><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1"> { </span><span class="hl-5">sent:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1"> };</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">worker</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">EmailWorker</span><span class="hl-1">(</span><span class="hl-5">redis</span><span class="hl-1">);</span><br/><span class="hl-5">worker</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">); </span><span class="hl-3">// starts the processing loop</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-8">Example<a href="#example-8" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Later, to stop the queue gracefully:</span><br/><span class="hl-5">worker</span><span class="hl-1">.</span><span class="hl-0">stop</span><span class="hl-1">(</span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">); </span><span class="hl-3">// loop will exit after the current iteration</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-4">Since<a href="#since-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-3">See<a href="#see-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#stop" class="tsd-kind-method">stop</a> - Signals the loop to stop.</li>
<li>loop - The main iteration loop invoked here.</li>
<li><a href="#iteration" class="tsd-kind-method">iteration</a> - Executes tasks with bounded concurrency.</li>
<li><a href="#reservemany" class="tsd-kind-method">reserveMany</a> - Reserves items from the ready list each iteration.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L2228">PowerQueue.ts:2228</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="stop"><span>stop</span><a href="#stop" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="stop-1"><span class="tsd-kind-call-signature">stop</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">queueName</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">void</span><a href="#stop-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">queueName</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The logical name of the queue to stop (e.g., <code>&quot;emails&quot;</code>).</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">void</span></h4><p><code>void</code> - the method completes immediately after signaling stop.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-5">Remarks<a href="#remarks-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This method signals an active queue loop (started via <a href="#run" class="tsd-kind-method">run</a>)
to <strong>terminate gracefully</strong>. It:</p>
<ol>
<li>Retrieves the runner record from the internal runners map.</li>
<li>If found, sets <code>running = false</code> to instruct the background loop
to stop after completing its current iteration.</li>
<li>Removes the queue’s runner entry from the map to free memory and
allow a subsequent <a href="#run" class="tsd-kind-method">run</a> call to restart it cleanly.</li>
</ol>
<p>The stop is cooperative - the active loop will exit on its next cycle
when it checks the <code>running</code> flag. No immediate termination or forced
cancellation occurs.</p>
<hr>
<h3 id="behavior-summary" class="tsd-anchor-link">Behavior summary<a href="#behavior-summary" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Step</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Set <code>r.running = false</code> to signal shutdown.</td>
</tr>
<tr>
<td>2</td>
<td>Remove queue from <code>runners</code> map.</td>
</tr>
<tr>
<td>3</td>
<td>Current iteration completes; future iterations stop.</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="why-it-matters" class="tsd-anchor-link">Why it matters<a href="#why-it-matters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Allows <strong>safe shutdown</strong> of background workers without corrupting Redis state.</li>
<li>Prevents concurrent queue restarts (a stopped queue can be restarted with <a href="#run" class="tsd-kind-method">run</a>).</li>
<li>Avoids dangling timers or intervals created by startHeartbeat.</li>
</ul>
<p>Performance:</p>
<ul>
<li>O(1) operation; no Redis calls involved.</li>
<li>The loop may take up to one full iteration cycle (up to <code>iterationTimeout</code>) to exit.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>Time: <code>O(1)</code></li>
<li>Space: <code>O(1)</code> (removes one entry from <code>runners</code>)</li>
</ul>
<p>Security:</p>
<ul>
<li>This function only affects local worker state, not Redis data.</li>
<li>It’s safe to call repeatedly; if the queue isn’t running, it silently no-ops.</li>
</ul>
<p>Notes:</p>
<ul>
<li>Calling <code>stop()</code> multiple times on the same queue is harmless.</li>
<li>To confirm the stop, you can check whether runners.has(queueName)
returns <code>false</code> after invocation.</li>
<li>Typically used during application shutdown or maintenance.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-9">Example<a href="#example-9" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Start the queue</span><br/><span class="hl-5">worker</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-2">&#39;notifications&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Later, during shutdown:</span><br/><span class="hl-5">worker</span><span class="hl-1">.</span><span class="hl-0">stop</span><span class="hl-1">(</span><span class="hl-2">&#39;notifications&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Queue stopped gracefully.&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-10">Example<a href="#example-10" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Safe to call even if not running - no error thrown:</span><br/><span class="hl-5">worker</span><span class="hl-1">.</span><span class="hl-0">stop</span><span class="hl-1">(</span><span class="hl-2">&#39;nonexistent-queue&#39;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-5">Since<a href="#since-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-4">See<a href="#see-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#run" class="tsd-kind-method">run</a> - Starts the background processing loop.</li>
<li>loop - Reads the <code>running</code> flag each iteration and exits when false.</li>
<li>runners - Internal map tracking currently active queue loops.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L2320">PowerQueue.ts:2320</a></li></ul></aside></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Methods - Lifecycle Hooks"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Methods - Lifecycle Hooks</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="afterexecution"><span>after<wbr/>Execution</span><a href="#afterexecution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="afterexecution-1"><span class="tsd-kind-call-signature">afterExecution</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">task</span><span class="tsd-signature-symbol">:</span> <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">result</span><span class="tsd-signature-symbol">:</span> <a href="../types/TaskResult.html" class="tsd-signature-type tsd-kind-type-alias">TaskResult</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/TaskResult.html" class="tsd-signature-type tsd-kind-type-alias">TaskResult</a><span class="tsd-signature-symbol">&gt;</span><a href="#afterexecution-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">task</span>: <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a></span><div class="tsd-comment tsd-typography"><p>The <a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> that was just executed.</p>
</div></li><li><span><span class="tsd-kind-parameter">result</span>: <a href="../types/TaskResult.html" class="tsd-signature-type tsd-kind-type-alias">TaskResult</a></span><div class="tsd-comment tsd-typography"><p>The <a href="../types/TaskResult.html" class="tsd-kind-type-alias">TaskResult</a> produced by <a href="#execute" class="tsd-kind-method">execute</a>.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/TaskResult.html" class="tsd-signature-type tsd-kind-type-alias">TaskResult</a><span class="tsd-signature-symbol">&gt;</span></h4><p>A <code>Promise</code> resolving to the final, possibly transformed, <a href="../types/TaskResult.html" class="tsd-kind-type-alias">TaskResult</a>
that will be stored or passed onward in the queue lifecycle.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-6">Remarks<a href="#remarks-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This hook provides a final opportunity to <strong>post-process or transform</strong>
the result of a completed task before it is recorded and passed to the next
lifecycle phase (such as success or <a href="#onsuccess" class="tsd-kind-method">onSuccess</a>).</p>
<p>The default implementation simply returns the same <code>result</code> unchanged,
but you can override it to perform operations like:</p>
<ul>
<li>Enriching or sanitizing the result before storage or logging.</li>
<li>Measuring execution duration or recording custom telemetry.</li>
<li>Adding metadata (e.g., timestamps, node IDs, version info).</li>
<li>Transforming internal result formats into a canonical structure.</li>
</ul>
<p>This method is called <strong>only if</strong> <a href="#execute" class="tsd-kind-method">execute</a> resolved successfully;
exceptions raised inside <a href="#execute" class="tsd-kind-method">execute</a> trigger retry or error handling
and skip this hook.</p>
<hr>
<h3 id="execution-flow" class="tsd-anchor-link">Execution flow<a href="#execution-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="text">beforeExecution(task)
   ↓
execute(task)
   ↓
afterExecution(task, result)
</code><button type="button">Copy</button></pre>

<hr>
<h3 id="typical-use-cases-1" class="tsd-anchor-link">Typical use cases<a href="#typical-use-cases-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Purpose</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Enrichment</strong></td>
<td>Add a <code>completedAt</code> timestamp to the result.</td>
</tr>
<tr>
<td><strong>Normalization</strong></td>
<td>Convert internal result shape into standard fields.</td>
</tr>
<tr>
<td><strong>Telemetry</strong></td>
<td>Log metrics about task latency or size.</td>
</tr>
<tr>
<td><strong>Auditing</strong></td>
<td>Persist result summaries in external storage.</td>
</tr>
</tbody>
</table>
<p>Performance:</p>
<ul>
<li>Runs once per successful task, after execution is complete.</li>
<li>Keep logic lightweight to avoid blocking subsequent task acknowledgment.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>Time: O(1) (default).</li>
<li>Space: O(1), unless cloning or deeply modifying large result objects.</li>
</ul>
<p>Security:</p>
<ul>
<li>Use this hook to strip or mask sensitive data before persisting or logging results.</li>
<li>Avoid throwing errors; errors here will be caught by the internal logic but may
prevent result propagation.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-11">Example<a href="#example-11" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: Add completion timestamp to each result</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">afterExecution</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">: </span><span class="hl-5">TaskResult</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">TaskResult</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  return { ...</span><span class="hl-5">result</span><span class="hl-1">, </span><span class="hl-10">completedAt</span><span class="hl-1">: </span><span class="hl-5">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() };</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-12">Example<a href="#example-12" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: Normalize output field names</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">afterExecution</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">: </span><span class="hl-5">TaskResult</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">TaskResult</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  return {</span><br/><span class="hl-1">    </span><span class="hl-10">success</span><span class="hl-1">: </span><span class="hl-0">Boolean</span><span class="hl-1">(</span><span class="hl-5">result</span><span class="hl-1">.</span><span class="hl-5">ok</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-10">details</span><span class="hl-1">: </span><span class="hl-5">result</span><span class="hl-1">.</span><span class="hl-5">message</span><span class="hl-1"> ?? </span><span class="hl-2">&#39;&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-13">Example<a href="#example-13" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Default implementation (no transformation)</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">afterExecution</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">: </span><span class="hl-5">TaskResult</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">TaskResult</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  return result;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-6">Since<a href="#since-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-5">See<a href="#see-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#execute" class="tsd-kind-method">execute</a> - Main business logic producing the result.</li>
<li><a href="#beforeexecution" class="tsd-kind-method">beforeExecution</a> - Prepares the task before execution.</li>
<li>logic - Internal handler invoking this hook.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L3012">PowerQueue.ts:3012</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="afteriterationexecution"><span>after<wbr/>Iteration<wbr/>Execution</span><a href="#afteriterationexecution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="afteriterationexecution-1"><span class="tsd-kind-call-signature">afterIterationExecution</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">data</span><span class="tsd-signature-symbol">:</span> <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">results</span><span class="tsd-signature-symbol">:</span> <a href="../types/TaskResult.html" class="tsd-signature-type tsd-kind-type-alias">TaskResult</a><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span><a href="#afteriterationexecution-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">data</span>: <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">[]</span></span><div class="tsd-comment tsd-typography"><p>Array of <a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> objects that were processed in this iteration.</p>
</div></li><li><span><span class="tsd-kind-parameter">results</span>: <a href="../types/TaskResult.html" class="tsd-signature-type tsd-kind-type-alias">TaskResult</a><span class="tsd-signature-symbol">[]</span></span><div class="tsd-comment tsd-typography"><p>Array of corresponding <a href="../types/TaskResult.html" class="tsd-kind-type-alias">TaskResult</a> objects returned by each task.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A <code>Promise&lt;void&gt;</code> resolved when post-processing is complete.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-7">Remarks<a href="#remarks-7" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This hook runs after <a href="#iteration" class="tsd-kind-method">iteration</a> finishes executing all tasks in the current
batch. It receives both:</p>
<ul>
<li><code>data</code>: the array of all <a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> objects that were processed, and</li>
<li><code>results</code>: a parallel array of their corresponding <a href="../types/TaskResult.html" class="tsd-kind-type-alias">TaskResult</a> outputs.</li>
</ul>
<p>The arrays are <strong>positionally aligned</strong>, meaning that <code>results[i]</code> corresponds
to <code>data[i]</code>. Both arrays are guaranteed to have the same length.</p>
<p>You can override this method to implement post-processing logic such as:</p>
<ul>
<li>Aggregating task results or metrics (e.g., success/failure counts).</li>
<li>Writing audit logs or analytics to external systems.</li>
<li>Emitting application-level events or WebSocket updates.</li>
<li>Cleaning up temporary resources, cache entries, or temporary files.</li>
</ul>
<p>The default implementation does nothing.</p>
<hr>
<h3 id="example-workflow" class="tsd-anchor-link">Example workflow<a href="#example-workflow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="text">beforeIterationExecution() → logic() (per-task)
                          ↳ afterIterationExecution()
</code><button type="button">Copy</button></pre>

<hr>
<h3 id="typical-use-cases-2" class="tsd-anchor-link">Typical use cases<a href="#typical-use-cases-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Use case</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Metrics aggregation</strong></td>
<td>Count how many tasks succeeded or failed.</td>
</tr>
<tr>
<td><strong>Batch logging</strong></td>
<td>Store all results into a single log record or DB entry.</td>
</tr>
<tr>
<td><strong>Progress tracking</strong></td>
<td>Update global progress counters in Redis or ClickHouse.</td>
</tr>
<tr>
<td><strong>Notification</strong></td>
<td>Send webhook or message once a batch completes.</td>
</tr>
</tbody>
</table>
<p>Performance:</p>
<ul>
<li>Called once per iteration, not per task - safe for expensive operations.</li>
<li>Runs <em>after</em> all task promises in <a href="#iteration" class="tsd-kind-method">iteration</a> have resolved.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>Time: O(n) in number of tasks if you scan through results.</li>
<li>Space: O(n) due to result arrays.</li>
</ul>
<p>Security:</p>
<ul>
<li>Avoid logging full payloads or results if they may contain sensitive data.</li>
<li>Use aggregation or masking when exporting data externally.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-14">Example<a href="#example-14" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: Log iteration summary</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">afterIterationExecution</span><span class="hl-1">(</span><span class="hl-5">tasks</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">[], </span><span class="hl-5">results</span><span class="hl-1">: </span><span class="hl-5">TaskResult</span><span class="hl-1">[]): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  const </span><span class="hl-5">total</span><span class="hl-1"> = </span><span class="hl-5">tasks</span><span class="hl-1">.</span><span class="hl-5">length</span><span class="hl-1">;</span><br/><span class="hl-1">  const </span><span class="hl-5">success</span><span class="hl-1"> = </span><span class="hl-5">results</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-5">r</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-5">r</span><span class="hl-1">.</span><span class="hl-5">status</span><span class="hl-1"> === </span><span class="hl-2">&#39;ok&#39;</span><span class="hl-1">).</span><span class="hl-5">length</span><span class="hl-1">;</span><br/><span class="hl-1">  console.log(</span><span class="hl-2">`[Iteration] </span><span class="hl-6">${</span><span class="hl-5">success</span><span class="hl-6">}</span><span class="hl-2">/</span><span class="hl-6">${</span><span class="hl-5">total</span><span class="hl-6">}</span><span class="hl-2"> tasks succeeded`</span><span class="hl-5">);</span><br/><span class="hl-5">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-15">Example<a href="#example-15" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: Send aggregated metrics to Redis</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">afterIterationExecution</span><span class="hl-1">(</span><span class="hl-5">tasks</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">[], </span><span class="hl-5">results</span><span class="hl-1">: </span><span class="hl-5">TaskResult</span><span class="hl-1">[]): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  const </span><span class="hl-5">successCount</span><span class="hl-1"> = </span><span class="hl-5">results</span><span class="hl-1">.</span><span class="hl-0">filter</span><span class="hl-1">(</span><span class="hl-5">r</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-5">r</span><span class="hl-1">.</span><span class="hl-5">success</span><span class="hl-1"> === </span><span class="hl-6">true</span><span class="hl-1">).</span><span class="hl-5">length</span><span class="hl-1">;</span><br/><span class="hl-1">  await this.redis.incrby(</span><span class="hl-2">&#39;queue:iteration:success&#39;</span><span class="hl-1">, successCount);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-7">Since<a href="#since-7" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-6">See<a href="#see-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#iteration" class="tsd-kind-method">iteration</a> - Calls this method after concurrent batch execution.</li>
<li><a href="#beforeiterationexecution" class="tsd-kind-method">beforeIterationExecution</a> - Prepares the batch before this hook.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L2819">PowerQueue.ts:2819</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="beforeexecution"><span>before<wbr/>Execution</span><a href="#beforeexecution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="beforeexecution-1"><span class="tsd-kind-call-signature">beforeExecution</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">task</span><span class="tsd-signature-symbol">:</span> <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">&gt;</span><a href="#beforeexecution-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">task</span>: <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a></span><div class="tsd-comment tsd-typography"><p>The task object about to be executed.
Contains metadata, payload, retry counters, and progress info.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">&gt;</span></h4><p>A <code>Promise</code> resolving to either the original or a modified <a href="../types/Task.html" class="tsd-kind-type-alias">Task</a>
that will be passed into <a href="#execute" class="tsd-kind-method">execute</a>.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-8">Remarks<a href="#remarks-8" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This hook allows you to <strong>inspect, enrich, or modify</strong> a task right before it is
executed by the main business logic in <a href="#execute" class="tsd-kind-method">execute</a>.<br>
It runs once per task, immediately before its <a href="#execute" class="tsd-kind-method">execute</a> method is called.</p>
<p>The default implementation simply returns the same <code>task</code> unchanged, but subclasses
can override this method to:</p>
<ul>
<li>Add contextual metadata (e.g., request IDs, trace tokens, timestamps).</li>
<li>Validate or sanitize the task’s payload.</li>
<li>Transform the task into a richer form required by the business logic.</li>
<li>Short-circuit certain tasks by marking them as already handled.</li>
</ul>
<p>This hook runs <strong>inside the execution pipeline</strong> managed by logic, so any
exceptions thrown here will be caught and handled through the retry/error chain.</p>
<hr>
<h3 id="execution-flow-1" class="tsd-anchor-link">Execution flow<a href="#execution-flow-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="text">beforeExecution(task)
   ↓
execute(task)
   ↓
afterExecution(task, result)
</code><button type="button">Copy</button></pre>

<hr>
<h3 id="typical-use-cases-3" class="tsd-anchor-link">Typical use cases<a href="#typical-use-cases-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Purpose</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Enrichment</strong></td>
<td>Add a timestamp or context key before processing.</td>
</tr>
<tr>
<td><strong>Validation</strong></td>
<td>Throw if payload lacks required fields.</td>
</tr>
<tr>
<td><strong>Normalization</strong></td>
<td>Adjust data types or default values.</td>
</tr>
<tr>
<td><strong>Debugging</strong></td>
<td>Log the task ID or payload before execution.</td>
</tr>
</tbody>
</table>
<p>Performance:</p>
<ul>
<li>Runs once per task; keep logic lightweight to avoid per-task overhead.</li>
<li>Avoid network or heavy I/O here; prefer inside <a href="#execute" class="tsd-kind-method">execute</a>.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>Time: O(1) per task (default).</li>
<li>Space: O(1) if not cloning; O(n) only if duplicating payloads.</li>
</ul>
<p>Security:</p>
<ul>
<li>A good place to enforce type validation, input filtering, or security checks
before untrusted data is processed in <a href="#execute" class="tsd-kind-method">execute</a>.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-16">Example<a href="#example-16" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: Enrich the task with a correlation ID</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">beforeExecution</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">Task</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  return {</span><br/><span class="hl-1">    ...</span><span class="hl-5">task</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">payload</span><span class="hl-1">: { ...</span><span class="hl-5">task</span><span class="hl-1">.</span><span class="hl-5">payload</span><span class="hl-1">, </span><span class="hl-10">correlationId</span><span class="hl-1">: </span><span class="hl-0">uuid</span><span class="hl-1">() },</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-17">Example<a href="#example-17" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: Validate payload structure before execution</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">beforeExecution</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">Task</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-5">typeof</span><span class="hl-1"> task.payload?.userId !== </span><span class="hl-2">&#39;number&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&#39;Invalid task payload: missing userId&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  return task;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-18">Example<a href="#example-18" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Default implementation (no changes)</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">beforeExecution</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">Task</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  return task;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-8">Since<a href="#since-8" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-7">See<a href="#see-7" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#execute" class="tsd-kind-method">execute</a> - Called immediately after this hook.</li>
<li><a href="#afterexecution" class="tsd-kind-method">afterExecution</a> - Runs after the main execution completes.</li>
<li>logic - Internal pipeline controlling per-task execution.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L2915">PowerQueue.ts:2915</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="beforeiterationexecution"><span>before<wbr/>Iteration<wbr/>Execution</span><a href="#beforeiterationexecution" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="beforeiterationexecution-1"><span class="tsd-kind-call-signature">beforeIterationExecution</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">data</span><span class="tsd-signature-symbol">:</span> <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">&gt;</span><a href="#beforeiterationexecution-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">data</span>: <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">[]</span></span><div class="tsd-comment tsd-typography"><p>The list of <a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> objects reserved for this iteration.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A promise resolving to the array of tasks to actually execute during this iteration.
The returned array replaces the input for the subsequent processing stage.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-9">Remarks<a href="#remarks-9" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This method allows subclasses to <strong>inspect, transform, filter, or reorder</strong>
the list of tasks right before they are processed by <a href="#iteration" class="tsd-kind-method">iteration</a>.</p>
<p>By default, it simply returns the same array (<code>data</code>) unchanged, but you can
override it in your subclass to implement pre-processing logic such as:</p>
<ul>
<li>Filtering out tasks that do not meet certain conditions.</li>
<li>Sorting tasks by priority or timestamp.</li>
<li>Enriching tasks with additional metadata (e.g., configuration or context).</li>
<li>Grouping or deduplicating jobs within the batch.</li>
</ul>
<h3 id="typical-use-cases-4" class="tsd-anchor-link">Typical use cases<a href="#typical-use-cases-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Prioritization</strong>: sort by a priority field before execution.</li>
<li><strong>Deduplication</strong>: remove tasks with identical payloads.</li>
<li><strong>Conditional skipping</strong>: drop tasks that are outdated or malformed.</li>
<li><strong>Instrumentation</strong>: record metrics about the batch before running.</li>
</ul>
<p>Performance:</p>
<ul>
<li>O(n) in the number of tasks (linear pass if you modify/filter them).</li>
<li>Usually negligible overhead; keep transformations synchronous or fast.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>Time: depends on your transformation (default O(1)).</li>
<li>Space: O(n) if returning a new array; O(1) if modifying in place.</li>
</ul>
<p>Security:</p>
<ul>
<li>You can enforce access control or payload validation here before tasks reach <a href="#execute" class="tsd-kind-method">execute</a>.</li>
<li>Never mutate critical IDs (<code>id</code>, <code>iterationId</code>, etc.) unless you understand the implications.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-19">Example<a href="#example-19" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: filter out tasks missing a required field</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">beforeIterationExecution</span><span class="hl-1">(</span><span class="hl-5">tasks</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">[]): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">Task</span><span class="hl-1">[]&gt; {</span><br/><span class="hl-1">  return tasks.filter(</span><span class="hl-5">t</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">typeof</span><span class="hl-1"> </span><span class="hl-5">t</span><span class="hl-1">.</span><span class="hl-5">payload</span><span class="hl-1">?.</span><span class="hl-5">userId</span><span class="hl-1"> === </span><span class="hl-2">&#39;number&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-20">Example<a href="#example-20" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: sort by custom priority value before execution</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">beforeIterationExecution</span><span class="hl-1">(</span><span class="hl-5">tasks</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">[]): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">Task</span><span class="hl-1">[]&gt; {</span><br/><span class="hl-1">  return tasks.sort((</span><span class="hl-5">a</span><span class="hl-1">, b) =&gt; (b.payload.priority ?? </span><span class="hl-8">0</span><span class="hl-5">) -</span><span class="hl-1"> (a.payload.priority ?? </span><span class="hl-8">0</span><span class="hl-5">));</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-21">Example<a href="#example-21" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Default implementation (no modification)</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">beforeIterationExecution</span><span class="hl-1">(</span><span class="hl-5">tasks</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">[]): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-5">Task</span><span class="hl-1">[]&gt; {</span><br/><span class="hl-1">  return tasks;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-9">Since<a href="#since-9" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-8">See<a href="#see-8" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#iteration" class="tsd-kind-method">iteration</a> - Uses this method at the beginning of each processing cycle.</li>
<li><a href="#afteriterationexecution" class="tsd-kind-method">afterIterationExecution</a> - Complementary hook called after all tasks complete.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L2735">PowerQueue.ts:2735</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="onchainsuccess"><span>on<wbr/>Chain<wbr/>Success</span><a href="#onchainsuccess" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="onchainsuccess-1"><span class="tsd-kind-call-signature">onChainSuccess</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">task</span><span class="tsd-signature-symbol">:</span> <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">result</span><span class="tsd-signature-symbol">:</span> <a href="../types/TaskResult.html" class="tsd-signature-type tsd-kind-type-alias">TaskResult</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span><a href="#onchainsuccess-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">task</span>: <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a></span><div class="tsd-comment tsd-typography"><p>The final <a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> instance in the chain.<br>
Contains accumulated metadata (progress timestamps, retries, chain index, etc.).</p>
</div></li><li><span><span class="tsd-kind-parameter">result</span>: <a href="../types/TaskResult.html" class="tsd-signature-type tsd-kind-type-alias">TaskResult</a></span><div class="tsd-comment tsd-typography"><p>The combined <a href="../types/TaskResult.html" class="tsd-kind-type-alias">TaskResult</a> returned from the last task’s
<a href="#execute" class="tsd-kind-method">execute</a> call. Typically includes merged data from previous stages.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A <code>Promise&lt;void&gt;</code> that resolves once your post-chain logic completes.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-10">Remarks<a href="#remarks-10" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This hook represents the <strong>final success stage</strong> of a multi-queue workflow.</p>
<p>A <a href="../types/TaskChain.html" class="tsd-kind-type-alias">TaskChain</a> is a sequence of related queues (<code>chain.queues</code>) that a task
automatically flows through - each queue representing a processing stage.
When the chain reaches its last queue and the final task succeeds,
this hook is invoked to signal <strong>end-of-chain completion</strong>.</p>
<p>Override this method to implement post-chain behavior such as:</p>
<ul>
<li>Marking a complex multi-step process as complete.</li>
<li>Merging results from multiple intermediate tasks.</li>
<li>Notifying external systems (webhooks, message buses, APIs).</li>
<li>Recording global completion metrics or audit logs.</li>
</ul>
<p>The default implementation does nothing.</p>
<hr>
<h3 id="chain-success-flow" class="tsd-anchor-link">Chain success flow<a href="#chain-success-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="text">execute(task) → returns TaskResult
    ↓
success(task, result)
    ↓
(detects chain completion)
    ↓
onChainSuccess(task, result) → this hook
</code><button type="button">Copy</button></pre>

<hr>
<h3 id="behavior" class="tsd-anchor-link">Behavior<a href="#behavior" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Triggered <strong>only once per chain</strong>, at its final stage (last queue).</li>
<li>Automatically called after <a href="#onsuccess" class="tsd-kind-method">onSuccess</a> for the last task in the sequence.</li>
<li>Does not interfere with other queues; purely informational and user-defined.</li>
<li>Exceptions thrown here are caught internally to avoid affecting the worker loop.</li>
</ul>
<hr>
<h3 id="typical-use-cases-5" class="tsd-anchor-link">Typical use cases<a href="#typical-use-cases-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Use case</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Finalization</strong></td>
<td>Mark the overall job as complete in a database.</td>
</tr>
<tr>
<td><strong>Aggregation</strong></td>
<td>Store or summarize results from all chain stages.</td>
</tr>
<tr>
<td><strong>Notification</strong></td>
<td>Send webhook or message to indicate chain success.</td>
</tr>
<tr>
<td><strong>Metrics</strong></td>
<td>Increment counters for successfully completed chains.</td>
</tr>
</tbody>
</table>
<p>Performance:</p>
<ul>
<li>Runs once per fully completed chain.</li>
<li>Suitable for lightweight completion logic or async reporting.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>O(1) per chain. May vary depending on custom I/O operations.</li>
</ul>
<p>Security:</p>
<ul>
<li>Avoid exposing sensitive task results in external notifications.</li>
<li>Redact private data before logging or sending externally.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-22">Example<a href="#example-22" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: log final completion</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onChainSuccess</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">: </span><span class="hl-5">TaskResult</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  console.info(</span><br/><span class="hl-1">    </span><span class="hl-2">`Chain completed for </span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">queueName</span><span class="hl-6">}</span><span class="hl-2">:`</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">`Final result:`</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">result</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-23">Example<a href="#example-23" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: record chain completion in Redis</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onChainSuccess</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">: </span><span class="hl-5">TaskResult</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  await this.redis.incr(</span><span class="hl-2">`stats:</span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">queueName</span><span class="hl-6">}</span><span class="hl-2">:chains:success`</span><span class="hl-5">);</span><br/><span class="hl-5">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-24">Example<a href="#example-24" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: trigger external webhook</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onChainSuccess</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">: </span><span class="hl-5">TaskResult</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  await </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">&#39;https://api.example.com/notify&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-5">method</span><span class="hl-1">: </span><span class="hl-2">&#39;POST&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">headers</span><span class="hl-1">: { </span><span class="hl-2">&#39;Content-Type&#39;</span><span class="hl-1">: </span><span class="hl-2">&#39;application/json&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-5">body</span><span class="hl-1">: </span><span class="hl-5">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-5">jobId:</span><span class="hl-1"> </span><span class="hl-5">task</span><span class="hl-1">.</span><span class="hl-5">iterationId</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">chain:</span><span class="hl-1"> </span><span class="hl-5">task</span><span class="hl-1">.</span><span class="hl-5">chain</span><span class="hl-1">.</span><span class="hl-5">queues</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">status:</span><span class="hl-1"> </span><span class="hl-2">&#39;success&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">result</span><span class="hl-1">,</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-25">Example<a href="#example-25" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Default (no operation)</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onChainSuccess</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">: </span><span class="hl-5">TaskResult</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-3">// no-op</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-10">Since<a href="#since-10" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-9">See<a href="#see-9" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="../types/TaskChain.html" class="tsd-kind-type-alias">TaskChain</a> - Describes queue sequences executed in order.</li>
<li><a href="#onsuccess" class="tsd-kind-method">onSuccess</a> - Runs after individual task success.</li>
<li>success - Internal logic that triggers this hook at the final chain stage.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L3776">PowerQueue.ts:3776</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="onerror"><span>on<wbr/>Error</span><a href="#onerror" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="onerror-1"><span class="tsd-kind-call-signature">onError</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">err</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type external">Error</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">task</span><span class="tsd-signature-symbol">:</span> <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span><a href="#onerror-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">err</span>: <span class="tsd-signature-type external">Error</span></span><div class="tsd-comment tsd-typography"><p>The Error object thrown during task execution.<br>
Contains message, stack, and possibly additional properties from the failure.</p>
</div></li><li><span><span class="tsd-kind-parameter">task</span>: <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a></span><div class="tsd-comment tsd-typography"><p>The <a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> instance that caused the error.
Includes identifying fields (<code>id</code>, <code>queueName</code>) and payload details.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A <code>Promise&lt;void&gt;</code> that resolves once your error-handling side effect completes.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-11">Remarks<a href="#remarks-11" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This method is called whenever <a href="#execute" class="tsd-kind-method">execute</a> or its preceding hooks
throw an exception that is <strong>not successfully handled</strong> by retry.</p>
<p>It represents a <strong>non-fatal failure</strong> - meaning the task failed this attempt,
but the worker process itself remains healthy and continues running.</p>
<p>You can override this hook to implement:</p>
<ul>
<li>Error logging (console, file, or external services like Sentry).</li>
<li>Application-specific error categorization or metrics collection.</li>
<li>Conditional alerts or diagnostics (e.g., network errors vs logic bugs).</li>
<li>Integration with distributed tracing or observability tools.</li>
</ul>
<p>The default implementation does nothing.</p>
<hr>
<h3 id="error-propagation-flow" class="tsd-anchor-link">Error propagation flow<a href="#error-propagation-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="text">execute(task) → throws Error
    ↓
retry(task) → fails or maxAttempts reached
    ↓
onError(err, task) → this hook
</code><button type="button">Copy</button></pre>

<hr>
<h3 id="behavior-1" class="tsd-anchor-link">Behavior<a href="#behavior-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Triggered after retry attempts are exhausted <em>for this iteration</em>,
or when retry scheduling itself fails.</li>
<li>Does <strong>not</strong> automatically stop the worker or requeue the task —
that is handled by error and fail.</li>
<li>Executed asynchronously; exceptions thrown here are caught internally.</li>
</ul>
<hr>
<h3 id="typical-use-cases-6" class="tsd-anchor-link">Typical use cases<a href="#typical-use-cases-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Use case</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Logging</strong></td>
<td>Write error details to console or structured logger.</td>
</tr>
<tr>
<td><strong>Monitoring</strong></td>
<td>Send metric counters for failed attempts.</td>
</tr>
<tr>
<td><strong>Alerting</strong></td>
<td>Notify developers on critical queue errors.</td>
</tr>
<tr>
<td><strong>Diagnostics</strong></td>
<td>Record stack traces for later debugging.</td>
</tr>
</tbody>
</table>
<p>Performance:</p>
<ul>
<li>Runs once per failed task (after retry/failure resolution).</li>
<li>Safe for I/O operations, but prefer batching for high-volume queues.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>O(1) default; depends on the complexity of your logging/alerting logic.</li>
</ul>
<p>Security:</p>
<ul>
<li>Avoid logging sensitive or personally identifiable information (PII).</li>
<li>Sanitize stack traces or payloads before exporting externally.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-26">Example<a href="#example-26" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: log the error details to console</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onError</span><span class="hl-1">(</span><span class="hl-5">err</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  console.error(</span><br/><span class="hl-1">    </span><span class="hl-2">`Task </span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">id</span><span class="hl-6">}</span><span class="hl-2"> (</span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">queueName</span><span class="hl-6">}</span><span class="hl-2">) failed: </span><span class="hl-6">${</span><span class="hl-5">err</span><span class="hl-11">.</span><span class="hl-5">message</span><span class="hl-6">}</span><span class="hl-2">`</span><br/><span class="hl-5">  );</span><br/><span class="hl-5">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-27">Example<a href="#example-27" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: send error to monitoring system</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onError</span><span class="hl-1">(</span><span class="hl-5">err</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  await this.redis.hset(</span><br/><span class="hl-1">    </span><span class="hl-2">`errors:</span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">queueName</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">    task.</span><span class="hl-5">id</span><span class="hl-1">,</span><br/><span class="hl-1">    JSON.stringify({ </span><span class="hl-10">message</span><span class="hl-1">: </span><span class="hl-5">err</span><span class="hl-1">.</span><span class="hl-5">message</span><span class="hl-1">, </span><span class="hl-10">time</span><span class="hl-1">: </span><span class="hl-5">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() })</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-28">Example<a href="#example-28" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Default (no operation)</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onError</span><span class="hl-1">(</span><span class="hl-5">err</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-3">// no-op</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-11">Since<a href="#since-11" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-10">See<a href="#see-10" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#onfail" class="tsd-kind-method">onFail</a> - Called when a task reaches max retry limit (permanent failure).</li>
<li>retry - Attempts to reschedule failed tasks before invoking this hook.</li>
<li><a href="#onfatal" class="tsd-kind-method">onFatal</a> - Handles unrecoverable or internal queue-level errors.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L3328">PowerQueue.ts:3328</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="onfail"><span>on<wbr/>Fail</span><a href="#onfail" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="onfail-1"><span class="tsd-kind-call-signature">onFail</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">err</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type external">Error</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">task</span><span class="tsd-signature-symbol">:</span> <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span><a href="#onfail-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">err</span>: <span class="tsd-signature-type external">Error</span></span><div class="tsd-comment tsd-typography"><p>The Error that caused the final failure.<br>
It typically includes the message and stack trace of the last thrown exception.</p>
</div></li><li><span><span class="tsd-kind-parameter">task</span>: <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a></span><div class="tsd-comment tsd-typography"><p>The <a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> object that has permanently failed.
Includes all metadata such as <code>queueName</code>, <code>id</code>, <code>currentAttempt</code>, and <code>payload</code>.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A <code>Promise&lt;void&gt;</code> resolving once the custom failure handling has completed.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-12">Remarks<a href="#remarks-12" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This method is invoked by fail once the system determines that
a task has reached its <strong>maximum attempt limit</strong> (<code>maxAttempts</code>) and
no further retries are allowed.</p>
<p>The task is then moved into a dedicated <strong>failure queue</strong>
(<code>&lt;queueName&gt;:&lt;iterationId&gt;:fail:list</code>) for inspection or debugging.</p>
<p>Override this hook to perform custom actions such as:</p>
<ul>
<li>Logging or persisting failure details.</li>
<li>Alerting operations teams about recurring critical errors.</li>
<li>Marking database records as &quot;failed&quot; or &quot;aborted.&quot;</li>
<li>Sending diagnostic information to external systems (e.g., Sentry, ELK, Prometheus).</li>
</ul>
<p>The default implementation is a no-op.</p>
<hr>
<h3 id="failure-flow" class="tsd-anchor-link">Failure flow<a href="#failure-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="text">execute(task) → throws Error
    ↓
retry(task) → maxAttempts reached
    ↓
fail(err, task)
    ↓
onFail(err, task) → this hook
</code><button type="button">Copy</button></pre>

<hr>
<h3 id="behavior-2" class="tsd-anchor-link">Behavior<a href="#behavior-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Runs <strong>after</strong> the task has been permanently classified as failed.</li>
<li>The task has already been re-enqueued into a <code>fail:list</code> queue for inspection.</li>
<li>Execution continues for other tasks; this hook does <strong>not</strong> stop the worker.</li>
<li>Exceptions thrown here are caught internally to avoid disrupting the main loop.</li>
</ul>
<hr>
<h3 id="typical-use-cases-7" class="tsd-anchor-link">Typical use cases<a href="#typical-use-cases-7" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Purpose</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Logging</strong></td>
<td>Record failure message and stack trace.</td>
</tr>
<tr>
<td><strong>Monitoring</strong></td>
<td>Increment “failed job” counters.</td>
</tr>
<tr>
<td><strong>Notification</strong></td>
<td>Alert developers about repeated failures.</td>
</tr>
<tr>
<td><strong>Recovery</strong></td>
<td>Mark corresponding DB entity as failed or expired.</td>
</tr>
</tbody>
</table>
<p>Performance:</p>
<ul>
<li>Runs once per permanently failed task.</li>
<li>Safe for moderate I/O (database writes, logging, etc.).</li>
</ul>
<p>Complexity:</p>
<ul>
<li>O(1) (default) or O(n) if performing bulk writes.</li>
</ul>
<p>Security:</p>
<ul>
<li>Be cautious when logging payloads or stack traces; sanitize sensitive data.</li>
<li>Use structured logging (JSON) for machine-readable error tracking.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-29">Example<a href="#example-29" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: log failure to console</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onFail</span><span class="hl-1">(</span><span class="hl-5">err</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  console.error(</span><br/><span class="hl-1">    </span><span class="hl-2">`Task </span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">id</span><span class="hl-6">}</span><span class="hl-2"> in queue &quot;</span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">queueName</span><span class="hl-6">}</span><span class="hl-2">&quot; permanently failed: </span><span class="hl-6">${</span><span class="hl-5">err</span><span class="hl-11">.</span><span class="hl-5">message</span><span class="hl-6">}</span><span class="hl-2">`</span><br/><span class="hl-5">  );</span><br/><span class="hl-5">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-30">Example<a href="#example-30" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: save failure details into Redis</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onFail</span><span class="hl-1">(</span><span class="hl-5">err</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  await this.redis.hset(</span><br/><span class="hl-1">    </span><span class="hl-2">`failures:</span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">queueName</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">,</span><br/><span class="hl-1">    task.</span><span class="hl-5">id</span><span class="hl-1">,</span><br/><span class="hl-1">    JSON.stringify({</span><br/><span class="hl-1">      </span><span class="hl-10">message</span><span class="hl-1">: </span><span class="hl-5">err</span><span class="hl-1">.</span><span class="hl-5">message</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-10">stack</span><span class="hl-1">: </span><span class="hl-5">err</span><span class="hl-1">.</span><span class="hl-5">stack</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-10">attempts</span><span class="hl-1">: </span><span class="hl-5">task</span><span class="hl-1">.</span><span class="hl-5">currentAttempt</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-10">time</span><span class="hl-1">: </span><span class="hl-5">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">(),</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-31">Example<a href="#example-31" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Default (no operation)</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onFail</span><span class="hl-1">(</span><span class="hl-5">err</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-3">// no-op</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-12">Since<a href="#since-12" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-11">See<a href="#see-11" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>retry - Handles exponential backoff and determines when to fail.</li>
<li><a href="#onerror" class="tsd-kind-method">onError</a> - Called for recoverable single-attempt failures.</li>
<li><a href="#onfatal" class="tsd-kind-method">onFatal</a> - Triggered when a deeper system error occurs.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L3440">PowerQueue.ts:3440</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="onfatal"><span>on<wbr/>Fatal</span><a href="#onfatal" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="onfatal-1"><span class="tsd-kind-call-signature">onFatal</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">err</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type external">Error</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">task</span><span class="tsd-signature-symbol">:</span> <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span><a href="#onfatal-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">err</span>: <span class="tsd-signature-type external">Error</span></span><div class="tsd-comment tsd-typography"><p>The Error that caused the unrecoverable failure.
Typically includes stack trace, message, and contextual metadata.</p>
</div></li><li><span><span class="tsd-kind-parameter">task</span>: <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a></span><div class="tsd-comment tsd-typography"><p>The <a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> being processed when the fatal error occurred.
May contain the payload and identifiers of the failing job.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A <code>Promise&lt;void&gt;</code> that resolves after your emergency handling logic completes.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-13">Remarks<a href="#remarks-13" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This method is invoked by the internal fail or error handlers
when an error occurs that <strong>cannot be retried</strong> and indicates a <strong>system-level problem</strong>, not
just a single task failure.</p>
<p>Examples of fatal errors include:</p>
<ul>
<li>Corrupted task payloads that cannot be parsed or validated.</li>
<li>Redis connection failures or transaction rollbacks.</li>
<li>Unhandled exceptions inside retry/failure hooks themselves.</li>
<li>Logic errors or programming bugs in custom worker code.</li>
</ul>
<p>You should override this hook to perform <strong>emergency logging, diagnostics, or shutdown actions</strong>, such as:</p>
<ul>
<li>Writing a critical log entry to an external monitoring service.</li>
<li>Sending an alert (email, Telegram, Slack, etc.) to maintainers.</li>
<li>Capturing diagnostic data or triggering an application health alarm.</li>
<li>Pausing or restarting the worker service if necessary.</li>
</ul>
<p>The default implementation is a no-op.</p>
<hr>
<h3 id="fatal-error-flow" class="tsd-anchor-link">Fatal error flow<a href="#fatal-error-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="text">execute(task) → throws Error
    ↓
retry/task handling fails unexpectedly
    ↓
onFatal(err, task) → this hook (final fallback)
</code><button type="button">Copy</button></pre>

<hr>
<h3 id="behavior-3" class="tsd-anchor-link">Behavior<a href="#behavior-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Called only when the system detects that recovery or retry logic
could not handle the error gracefully.</li>
<li>Executed asynchronously, and any exceptions thrown here are silently caught
to avoid recursive failure loops.</li>
<li>Does not stop the worker loop by itself - you can explicitly call <a href="#stop" class="tsd-kind-method">stop</a>
if needed to halt processing of the affected queue.</li>
</ul>
<hr>
<h3 id="typical-use-cases-8" class="tsd-anchor-link">Typical use cases<a href="#typical-use-cases-8" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Use case</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Alerting</strong></td>
<td>Send notification to DevOps via email/Slack/Telegram.</td>
</tr>
<tr>
<td><strong>Diagnostics</strong></td>
<td>Write stack trace and task payload to error logs.</td>
</tr>
<tr>
<td><strong>Auto-healing</strong></td>
<td>Stop or restart the queue runner if Redis is unstable.</td>
</tr>
<tr>
<td><strong>Telemetry</strong></td>
<td>Increment “fatal errors” counter for monitoring dashboards.</td>
</tr>
</tbody>
</table>
<p>Performance:</p>
<ul>
<li>Runs only in exceptional conditions, so performance impact is minimal.</li>
<li>Should focus on quick telemetry or alerting, not heavy recovery logic.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>O(1) per fatal event; depends on your implementation of error reporting.</li>
</ul>
<p>Security:</p>
<ul>
<li>Never include raw user or payload data in external alert messages.</li>
<li>Sanitize stack traces to avoid leaking internal paths or code details.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-32">Example<a href="#example-32" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: Send alert to monitoring channel</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onFatal</span><span class="hl-1">(</span><span class="hl-5">err</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  console.error(</span><span class="hl-2">&#39;[FATAL]&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-10">queue</span><span class="hl-1">: </span><span class="hl-5">task</span><span class="hl-1">.</span><span class="hl-5">queueName</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">id</span><span class="hl-1">: </span><span class="hl-5">task</span><span class="hl-1">.</span><span class="hl-5">id</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">message</span><span class="hl-1">: </span><span class="hl-5">err</span><span class="hl-1">.</span><span class="hl-5">message</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">stack</span><span class="hl-1">: </span><span class="hl-5">err</span><span class="hl-1">.</span><span class="hl-5">stack</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  await this.redis.incr(</span><span class="hl-2">&#39;stats:fatal_errors&#39;</span><span class="hl-5">);</span><br/><span class="hl-5">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-33">Example<a href="#example-33" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: Stop worker on repeated fatal errors</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onFatal</span><span class="hl-1">(</span><span class="hl-5">err</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  console.error(</span><span class="hl-2">`Fatal failure in queue &quot;</span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">queueName</span><span class="hl-6">}</span><span class="hl-2">&quot;:`</span><span class="hl-1">, err);</span><br/><span class="hl-1">  this.stop(task.queueName);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-34">Example<a href="#example-34" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Default (no operation)</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onFatal</span><span class="hl-1">(</span><span class="hl-5">err</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-3">// no-op</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-13">Since<a href="#since-13" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-12">See<a href="#see-12" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#onfail" class="tsd-kind-method">onFail</a> - Called for permanent (non-fatal) task failures.</li>
<li><a href="#onerror" class="tsd-kind-method">onError</a> - Handles recoverable per-task execution errors.</li>
<li><a href="#stop" class="tsd-kind-method">stop</a> - Can be called here to pause the affected queue.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L3551">PowerQueue.ts:3551</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="oniterationerror"><span>on<wbr/>Iteration<wbr/>Error</span><a href="#oniterationerror" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="oniterationerror-1"><span class="tsd-kind-call-signature">onIterationError</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">err</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type external">Error</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">queueName</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span><a href="#oniterationerror-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">err</span>: <span class="tsd-signature-type external">Error</span></span><div class="tsd-comment tsd-typography"><p>The Error object describing the iteration-level failure.<br>
Includes stack trace and message from the point of failure.</p>
</div></li><li><span><span class="tsd-kind-parameter">queueName</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The name of the queue whose iteration failed.
Corresponds to the <code>queueName</code> argument passed to <a href="#run" class="tsd-kind-method">run</a>.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A <code>Promise&lt;void&gt;</code> resolving once your error-handling logic completes.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-14">Remarks<a href="#remarks-14" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This method handles <strong>iteration-level failures</strong>, which differ from individual task errors:
it’s invoked when an unexpected error disrupts the entire queue iteration cycle —
for example, a Redis command failure, data deserialization issue, or logic bug inside
<a href="#iteration" class="tsd-kind-method">iteration</a>, <a href="#reservemany" class="tsd-kind-method">reserveMany</a>, or data.</p>
<p>The queue automatically catches such errors and invokes this hook, allowing you
to respond gracefully - e.g. log diagnostic information, alert developers, or temporarily pause the queue.</p>
<p>The default implementation does nothing.</p>
<hr>
<h3 id="iteration-error-flow" class="tsd-anchor-link">Iteration error flow<a href="#iteration-error-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="text">loop(queueName)
    ↓
  iteration()  ← (multiple tasks per batch)
    ↓
  throws Error
    ↓
onIterationError(err, queueName) → this hook
</code><button type="button">Copy</button></pre>

<hr>
<h3 id="behavior-4" class="tsd-anchor-link">Behavior<a href="#behavior-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Executed <strong>once per failed iteration</strong> (not per task).</li>
<li>Does <strong>not</strong> stop the queue automatically - the loop continues after a short delay.</li>
<li>Intended for global error logging, not individual job failure handling.</li>
<li>Exceptions thrown inside this hook are caught internally and ignored.</li>
</ul>
<hr>
<h3 id="typical-use-cases-9" class="tsd-anchor-link">Typical use cases<a href="#typical-use-cases-9" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Use case</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Logging</strong></td>
<td>Record unexpected iteration exceptions for debugging.</td>
</tr>
<tr>
<td><strong>Monitoring</strong></td>
<td>Increment Redis or Prometheus “iteration errors” counters.</td>
</tr>
<tr>
<td><strong>Alerting</strong></td>
<td>Notify administrators about repeated iteration-level faults.</td>
</tr>
<tr>
<td><strong>Diagnostics</strong></td>
<td>Save stack traces to disk for forensic analysis.</td>
</tr>
</tbody>
</table>
<p>Performance:</p>
<ul>
<li>Triggered rarely (only when an entire iteration fails).</li>
<li>Safe for moderate I/O operations such as writing to logs or Redis.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>O(1) default; depends on the complexity of your custom diagnostics logic.</li>
</ul>
<p>Security:</p>
<ul>
<li>Sanitize stack traces before logging externally.</li>
<li>Avoid exposing internal implementation details in public channels.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-35">Example<a href="#example-35" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: simple console logging</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onIterationError</span><span class="hl-1">(</span><span class="hl-5">err</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-5">queueName</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  console.error(</span><br/><span class="hl-1">    </span><span class="hl-2">`Iteration error in queue &quot;</span><span class="hl-6">${</span><span class="hl-5">queueName</span><span class="hl-6">}</span><span class="hl-2">&quot;: </span><span class="hl-6">${</span><span class="hl-5">err</span><span class="hl-11">.</span><span class="hl-5">message</span><span class="hl-6">}</span><span class="hl-2">`</span><br/><span class="hl-5">  );</span><br/><span class="hl-5">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-36">Example<a href="#example-36" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: record iteration errors in Redis for monitoring</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onIterationError</span><span class="hl-1">(</span><span class="hl-5">err</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-5">queueName</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  await this.redis.hset(</span><br/><span class="hl-1">    </span><span class="hl-2">`stats:</span><span class="hl-6">${</span><span class="hl-5">queueName</span><span class="hl-6">}</span><span class="hl-2">:iteration_errors`</span><span class="hl-1">,</span><br/><span class="hl-1">    Date.now().toString(),</span><br/><span class="hl-1">    JSON.stringify({ </span><span class="hl-10">message</span><span class="hl-1">: </span><span class="hl-5">err</span><span class="hl-1">.</span><span class="hl-5">message</span><span class="hl-1">, </span><span class="hl-10">stack</span><span class="hl-1">: </span><span class="hl-5">err</span><span class="hl-1">.</span><span class="hl-5">stack</span><span class="hl-1"> })</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-37">Example<a href="#example-37" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: notify developers through a webhook</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onIterationError</span><span class="hl-1">(</span><span class="hl-5">err</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-5">queueName</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  await </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">&#39;https://monitor.example.com/alert&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-5">method</span><span class="hl-1">: </span><span class="hl-2">&#39;POST&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">headers</span><span class="hl-1">: { </span><span class="hl-2">&#39;Content-Type&#39;</span><span class="hl-1">: </span><span class="hl-2">&#39;application/json&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-5">body</span><span class="hl-1">: </span><span class="hl-5">JSON</span><span class="hl-1">.</span><span class="hl-5">stringify</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-5">level:</span><span class="hl-1"> </span><span class="hl-2">&#39;error&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">source:</span><span class="hl-1"> </span><span class="hl-2">&#39;PowerQueue&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">queue:</span><span class="hl-1"> </span><span class="hl-5">queueName</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">message:</span><span class="hl-1"> </span><span class="hl-5">err</span><span class="hl-1">.</span><span class="hl-5">message</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">stack:</span><span class="hl-1"> </span><span class="hl-5">err</span><span class="hl-1">.</span><span class="hl-5">stack</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">time:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">().</span><span class="hl-0">toISOString</span><span class="hl-1">(),</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-38">Example<a href="#example-38" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Default (no operation)</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onIterationError</span><span class="hl-1">(</span><span class="hl-5">err</span><span class="hl-1">: </span><span class="hl-5">Error</span><span class="hl-1">, </span><span class="hl-5">queueName</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-3">// no-op</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-14">Since<a href="#since-14" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-13">See<a href="#see-13" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#iteration" class="tsd-kind-method">iteration</a> - The batch processor that may trigger this hook.</li>
<li>loop - The continuous worker cycle that catches iteration errors.</li>
<li><a href="#onerror" class="tsd-kind-method">onError</a> - Handles per-task failures within iterations.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L3897">PowerQueue.ts:3897</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="onretry"><span>on<wbr/>Retry</span><a href="#onretry" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="onretry-1"><span class="tsd-kind-call-signature">onRetry</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">task</span><span class="tsd-signature-symbol">:</span> <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span><a href="#onretry-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">task</span>: <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a></span><div class="tsd-comment tsd-typography"><p>The <a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> that has just been scheduled for retry.
It includes updated retry counters (<code>currentAttempt</code>), payload, and metadata.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A <code>Promise&lt;void&gt;</code> that resolves after your custom side effect completes.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-15">Remarks<a href="#remarks-15" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This method is automatically called by retry whenever a task fails
but has <strong>remaining attempts</strong> left (i.e., <code>currentAttempt &lt; maxAttempts</code>).</p>
<p>You can override this hook to perform custom side effects, such as:</p>
<ul>
<li>Logging or monitoring retry attempts.</li>
<li>Updating external dashboards or alerting systems.</li>
<li>Recording retry delays or failure reasons for analytics.</li>
<li>Emitting application events (“task requeued”, “attempt #2 started”, etc.).</li>
</ul>
<p>The default implementation does nothing.</p>
<hr>
<h3 id="retry-workflow" class="tsd-anchor-link">Retry workflow<a href="#retry-workflow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="text">execute(task) throws Error
    ↓
retry(task) schedules new delayed attempt
    ↓
onRetry(task) (this hook)
</code><button type="button">Copy</button></pre>

<hr>
<h3 id="timing-semantics" class="tsd-anchor-link">Timing &amp; semantics<a href="#timing-semantics" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Runs <strong>after</strong> the task has been re-enqueued for a future retry.</li>
<li>The delay for the next attempt is computed via exponential backoff with jitter
inside jitteredBackoffSec.</li>
<li>Does <strong>not</strong> block the main worker loop - called asynchronously.</li>
</ul>
<hr>
<h3 id="typical-use-cases-10" class="tsd-anchor-link">Typical use cases<a href="#typical-use-cases-10" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Use case</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Logging</strong></td>
<td>Write “Task X retried (#2)” to console or file.</td>
</tr>
<tr>
<td><strong>Metrics</strong></td>
<td>Increment retry counter in Prometheus or Redis.</td>
</tr>
<tr>
<td><strong>Debugging</strong></td>
<td>Store failure context for later inspection.</td>
</tr>
<tr>
<td><strong>Notifications</strong></td>
<td>Send alert when retries exceed a threshold.</td>
</tr>
</tbody>
</table>
<p>Performance:</p>
<ul>
<li>Runs once per retry attempt, after requeue scheduling completes.</li>
<li>Keep logic lightweight and non-blocking (avoid I/O where possible).</li>
</ul>
<p>Complexity:</p>
<ul>
<li>O(1) (default, no-op).</li>
<li>O(n) only if you perform custom batch logging or persistence.</li>
</ul>
<p>Security:</p>
<ul>
<li>Avoid logging full payloads if they contain sensitive user data.</li>
<li>Mask or truncate large payloads in monitoring systems.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-39">Example<a href="#example-39" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: log retry attempt with exponential delay</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onRetry</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  console.warn(</span><br/><span class="hl-1">    </span><span class="hl-2">`Task </span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">id</span><span class="hl-6">}</span><span class="hl-2"> (</span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">queueName</span><span class="hl-6">}</span><span class="hl-2">) retried - attempt #</span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">currentAttempt</span><span class="hl-6">}</span><span class="hl-2">`</span><br/><span class="hl-5">  );</span><br/><span class="hl-5">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-40">Example<a href="#example-40" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: increment Redis counter for retry stats</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onRetry</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  await this.redis.incr(</span><span class="hl-2">`stats:</span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">queueName</span><span class="hl-6">}</span><span class="hl-2">:retries`</span><span class="hl-5">);</span><br/><span class="hl-5">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-41">Example<a href="#example-41" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Default (no operation)</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onRetry</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-3">// no-op</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-15">Since<a href="#since-15" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-14">See<a href="#see-14" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>retry - Invokes this method when re-enqueuing a failed task.</li>
<li><a href="#onerror" class="tsd-kind-method">onError</a> - Called when a task fails immediately without retry.</li>
<li>jitteredBackoffSec - Computes the retry delay duration.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L3223">PowerQueue.ts:3223</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="onsuccess"><span>on<wbr/>Success</span><a href="#onsuccess" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="onsuccess-1"><span class="tsd-kind-call-signature">onSuccess</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">task</span><span class="tsd-signature-symbol">:</span> <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">result</span><span class="tsd-signature-symbol">:</span> <a href="../types/TaskResult.html" class="tsd-signature-type tsd-kind-type-alias">TaskResult</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span><a href="#onsuccess-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">task</span>: <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a></span><div class="tsd-comment tsd-typography"><p>The successfully completed <a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> instance,
containing metadata, payload, and progress tracking information.</p>
</div></li><li><span><span class="tsd-kind-parameter">result</span>: <a href="../types/TaskResult.html" class="tsd-signature-type tsd-kind-type-alias">TaskResult</a></span><div class="tsd-comment tsd-typography"><p>The <a href="../types/TaskResult.html" class="tsd-kind-type-alias">TaskResult</a> returned from <a href="#execute" class="tsd-kind-method">execute</a>,
typically a JSON-serializable object summarizing the operation outcome.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A <code>Promise&lt;void&gt;</code> resolving once the custom post-success logic has completed.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-16">Remarks<a href="#remarks-16" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This method is automatically called by success once the task’s
<a href="#execute" class="tsd-kind-method">execute</a> method finishes successfully and the result has been merged
into its <a href="../types/Task.html#result" class="tsd-kind-property">Task.result</a> object.</p>
<p>You can override this hook to perform post-processing or bookkeeping actions,
such as:</p>
<ul>
<li>Logging or reporting successful task completions.</li>
<li>Updating external state (database, cache, analytics, etc.).</li>
<li>Emitting application events (“job finished”, “file processed”, etc.).</li>
<li>Cleaning up temporary files or releasing external locks.</li>
</ul>
<p>The default implementation is a no-op.</p>
<hr>
<h3 id="success-flow" class="tsd-anchor-link">Success flow<a href="#success-flow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="text">execute(task) → returns TaskResult
    ↓
afterExecution(task, result)
    ↓
success(task, result)
    ↓
onSuccess(task, result) → this hook
</code><button type="button">Copy</button></pre>

<hr>
<h3 id="behavior-5" class="tsd-anchor-link">Behavior<a href="#behavior-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Runs only after the task has been successfully processed and acknowledged.</li>
<li>Executed once per successful task, asynchronously.</li>
<li>Exceptions thrown here are caught internally and will not affect other tasks.</li>
<li>If the task belongs to a <a href="../types/TaskChain.html" class="tsd-kind-type-alias">TaskChain</a>, the next queue is automatically
scheduled after this hook (handled inside success).</li>
</ul>
<hr>
<h3 id="typical-use-cases-11" class="tsd-anchor-link">Typical use cases<a href="#typical-use-cases-11" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Use case</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Logging</strong></td>
<td>Write “Task completed successfully” to logs.</td>
</tr>
<tr>
<td><strong>Metrics</strong></td>
<td>Increment success counters or track duration.</td>
</tr>
<tr>
<td><strong>Notifications</strong></td>
<td>Notify an API or message bus about completion.</td>
</tr>
<tr>
<td><strong>Cleanup</strong></td>
<td>Remove temporary files or transient Redis keys.</td>
</tr>
</tbody>
</table>
<p>Performance:</p>
<ul>
<li>Invoked once per successful task; avoid heavy blocking I/O here.</li>
<li>Ideal for lightweight asynchronous operations.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>O(1) default, but depends on your side-effect logic.</li>
</ul>
<p>Security:</p>
<ul>
<li>Avoid exposing sensitive data from <code>result</code> in logs or telemetry.</li>
<li>Sanitize outputs if <code>result</code> contains user-provided content.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-42">Example<a href="#example-42" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: Log the result to console</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onSuccess</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">: </span><span class="hl-5">TaskResult</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  console.info(</span><br/><span class="hl-1">    </span><span class="hl-2">`OK: Task </span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">id</span><span class="hl-6">}</span><span class="hl-2"> (</span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">queueName</span><span class="hl-6">}</span><span class="hl-2">) completed successfully:`</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-5">result</span><br/><span class="hl-1">  );</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-43">Example<a href="#example-43" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example: Track successful jobs in Redis</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onSuccess</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">: </span><span class="hl-5">TaskResult</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  await this.redis.incr(</span><span class="hl-2">`stats:</span><span class="hl-6">${</span><span class="hl-5">task</span><span class="hl-11">.</span><span class="hl-5">queueName</span><span class="hl-6">}</span><span class="hl-2">:success`</span><span class="hl-5">);</span><br/><span class="hl-5">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-44">Example<a href="#example-44" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Default (no operation)</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onSuccess</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">: </span><span class="hl-5">Task</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">: </span><span class="hl-5">TaskResult</span><span class="hl-1">): </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-6">void</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  </span><span class="hl-3">// no-op</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-16">Since<a href="#since-16" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-15">See<a href="#see-15" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#afterexecution" class="tsd-kind-method">afterExecution</a> - Runs immediately before this hook.</li>
<li><a href="#onchainsuccess" class="tsd-kind-method">onChainSuccess</a> - Triggered when the entire <a href="../types/TaskChain.html" class="tsd-kind-type-alias">TaskChain</a> finishes.</li>
<li>success - Internal orchestrator that invokes this hook.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L3654">PowerQueue.ts:3654</a></li></ul></aside></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Methods - Queue Production"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Methods - Queue Production</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="addtask"><span>add<wbr/>Task</span><a href="#addtask" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="addtask-1"><span class="tsd-kind-call-signature">addTask</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">data</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Partial</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">delaySec</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">&gt;</span><a href="#addtask-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">data</span>: <span class="tsd-signature-type">Partial</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">&gt;</span></span><div class="tsd-comment tsd-typography"><p>Partial task description. Must contain a valid <code>queueName</code>; the rest is defaulted by <a href="#buildtask" class="tsd-kind-method">buildTask</a>.</p>
</div></li><li><span><code class="tsd-tag">Optional</code><span class="tsd-kind-parameter">delaySec</span>: <span class="tsd-signature-type">number</span></span><div class="tsd-comment tsd-typography"><p>Optional delay in <strong>seconds</strong> before the task is eligible to run. If not a positive number, the task is enqueued immediately.<br>
{Default: 0 (immediate)}</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A promise resolving to the numeric result of the underlying Redis write:</p>
<ul>
<li><code>RPUSH</code> → new length of the ready LIST,</li>
<li><code>ZADD</code>  → number of elements added to the delayed ZSET (0 or 1).</li>
</ul>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-17">Remarks<a href="#remarks-17" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This convenience method wraps two core responsibilities:</p>
<ol>
<li><strong>Task construction</strong> - calls <a href="#buildtask" class="tsd-kind-method">buildTask</a> to validate and complete
the provided <code>Partial&lt;Task&gt;</code> (generates UUIDs, fills defaults, normalizes sub-objects).</li>
<li><strong>Enqueueing</strong> - computes queue keys via readyKey/delayedKey and
delegates the actual write to <a href="#enqueue" class="tsd-kind-method">enqueue</a>, which:
<ul>
<li><code>RPUSH</code>es to the <strong>ready</strong> LIST for immediate processing, or</li>
<li><code>ZADD</code>s to the <strong>delayed</strong> ZSET if <code>delaySec &gt; 0</code> (score = <code>now + delaySec</code>).</li>
</ul>
</li>
</ol>
<p>This is the typical entry point used by producers to submit work to a queue.</p>
<hr>
<h3 id="behavior-summary-1" class="tsd-anchor-link">Behavior summary<a href="#behavior-summary-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Input</th>
<th>Destination</th>
<th>Redis command</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>delaySec</code> ≤ 0 or not a positive number</td>
<td><code>ready</code> (LIST)</td>
<td><code>RPUSH</code></td>
<td>Job is available immediately.</td>
</tr>
<tr>
<td><code>delaySec</code> &gt; 0</td>
<td><code>delayed</code> (ZSET)</td>
<td><code>ZADD</code></td>
<td>Scheduled; later promoted by <a href="#promotedelayed" class="tsd-kind-method">promoteDelayed</a>.</td>
</tr>
</tbody>
</table>
<p>Keys are derived from <code>data.queueName</code> using readyKey / delayedKey,
which in turn rely on <a href="#tokeystring" class="tsd-kind-method">toKeyString</a> for strict, safe namespacing.</p>
<p>Performance:</p>
<ul>
<li>Minimal overhead: <code>buildTask</code> is in-memory; <code>enqueue</code> is a single Redis call.</li>
<li>Suitable for high-throughput producers; consider batching at the application level if needed.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>Time: <code>O(1)</code> (serialize + one Redis write).</li>
<li>Space: proportional to payload size stored in Redis.</li>
</ul>
<p>Security:</p>
<ul>
<li>Validates structure via <a href="#buildtask" class="tsd-kind-method">buildTask</a>; payload content is not sanitized here.</li>
<li>Always use safe queue names; <code>readyKey</code>/<code>delayedKey</code> ensure namespacing.</li>
</ul>
</div><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-4">Throws<a href="#throws-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>Any error thrown by <a href="#buildtask" class="tsd-kind-method">buildTask</a> (e.g., <code>&quot;Queue name is not valid.&quot;</code>).</li>
<li>Any error thrown by <a href="#enqueue" class="tsd-kind-method">enqueue</a> / Redis client calls.</li>
<li><code>&quot;Redis connection error.&quot;</code> if the client is disconnected (propagated from <a href="#enqueue" class="tsd-kind-method">enqueue</a>).</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-45">Example<a href="#example-45" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Immediate enqueue (no delay)</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">addTask</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">queueName:</span><span class="hl-1"> </span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">payload:</span><span class="hl-1"> { </span><span class="hl-5">to:</span><span class="hl-1"> </span><span class="hl-2">&#39;user@example.com&#39;</span><span class="hl-1">, </span><span class="hl-5">subject:</span><span class="hl-1"> </span><span class="hl-2">&#39;Hello&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-5">maxAttempts:</span><span class="hl-1"> </span><span class="hl-8">3</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-46">Example<a href="#example-46" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Schedule a task to run 30 seconds later</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">addTask</span><span class="hl-1">(</span><br/><span class="hl-1">  { </span><span class="hl-5">queueName:</span><span class="hl-1"> </span><span class="hl-2">&#39;reports&#39;</span><span class="hl-1">, </span><span class="hl-5">payload:</span><span class="hl-1"> { </span><span class="hl-5">reportId:</span><span class="hl-1"> </span><span class="hl-2">&#39;r-123&#39;</span><span class="hl-1"> } },</span><br/><span class="hl-1">  </span><span class="hl-8">30</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-17">Since<a href="#since-17" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-16">See<a href="#see-16" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#buildtask" class="tsd-kind-method">buildTask</a> - Normalizes and validates the Task.</li>
<li><a href="#enqueue" class="tsd-kind-method">enqueue</a> - Performs the actual Redis write (RPUSH/ZADD).</li>
<li><a href="#promotedelayed" class="tsd-kind-method">promoteDelayed</a> - Later moves due delayed jobs to the ready list.</li>
<li>readyKey | delayedKey - Construct the Redis keys from the queue name.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L2567">PowerQueue.ts:2567</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="enqueue"><span>enqueue</span><a href="#enqueue" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="enqueue-1"><span class="tsd-kind-call-signature">enqueue</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">ready</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">delayed</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">payload</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">delaySec</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">&gt;</span><a href="#enqueue-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">ready</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Redis <strong>LIST</strong> key that represents the queue’s “ready-to-run” list.<br>
Typically built via readyKey.</p>
</div></li><li><span><span class="tsd-kind-parameter">delayed</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Redis <strong>ZSET</strong> key used for <strong>delayed</strong> (scheduled) jobs.<br>
Typically built via delayedKey.</p>
</div></li><li><span><span class="tsd-kind-parameter">payload</span>: <span class="tsd-signature-type">any</span></span><div class="tsd-comment tsd-typography"><p>The data or task object to be serialized and queued.<br>
It can be any JSON-compatible object; internally converted to string.</p>
</div></li><li><span><code class="tsd-tag">Optional</code><span class="tsd-kind-parameter">delaySec</span>: <span class="tsd-signature-type">number</span></span><div class="tsd-comment tsd-typography"><p>Optional delay (in <strong>seconds</strong>) before the job becomes active.<br>
If &gt; 0, the job goes to <code>delayed</code>; otherwise to <code>ready</code>.<br>
{Default: 0 (immediate enqueue)}</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A promise resolving to the result of the Redis write operation:</p>
<ul>
<li>For <code>RPUSH</code>, the <strong>new length</strong> of the ready list.</li>
<li>For <code>ZADD</code>, the <strong>number of new elements added</strong> (0 or 1).</li>
</ul>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-18">Remarks<a href="#remarks-18" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The enqueue process serializes the provided <code>payload</code> into a raw string
(via toPayload) and pushes it to the appropriate Redis data structure:</p>
<ul>
<li>
<p><strong>Immediate tasks:</strong></p>
<ul>
<li>Stored in the <code>ready</code> <strong>LIST</strong> using <code>RPUSH</code>.</li>
<li>These tasks become instantly available to workers via <a href="#reservemany" class="tsd-kind-method">reserveMany</a>.</li>
</ul>
</li>
<li>
<p><strong>Delayed tasks:</strong></p>
<ul>
<li>Stored in the <code>delayed</code> <strong>ZSET</strong> using <code>ZADD delayed &lt;score&gt; &lt;raw&gt;</code>.</li>
<li>The <strong>score</strong> is the UNIX timestamp (seconds) representing the moment when
the task becomes eligible for execution.</li>
<li>The task will later be automatically moved to the <code>ready</code> list by
<a href="#promotedelayed" class="tsd-kind-method">promoteDelayed</a> once its score ≤ current time.</li>
</ul>
</li>
</ul>
<hr>
<h3 id="behavior-summary-2" class="tsd-anchor-link">Behavior summary<a href="#behavior-summary-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Mode</th>
<th>Condition</th>
<th>Redis Command</th>
<th>Destination</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Immediate</td>
<td><code>delaySec</code> ≤ 0 or undefined</td>
<td><code>RPUSH</code></td>
<td><code>ready</code> list</td>
<td>Job ready for immediate processing.</td>
</tr>
<tr>
<td>Delayed</td>
<td><code>delaySec</code> &gt; 0</td>
<td><code>ZADD</code> (score = now + delaySec)</td>
<td><code>delayed</code> ZSET</td>
<td>Job scheduled for later execution.</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="typical-lifecycle" class="tsd-anchor-link">Typical lifecycle<a href="#typical-lifecycle" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li>The producer calls <code>enqueue()</code> with a payload.</li>
<li>If delayed, the item sits in the ZSET until <code>now ≥ score</code>.</li>
<li>The worker’s <a href="#promotedelayed" class="tsd-kind-method">promoteDelayed</a> promotes it into the ready list.</li>
<li>The worker <a href="#reservemany" class="tsd-kind-method">reserveMany</a> then picks it up for processing.</li>
</ol>
<hr>
<p>Performance:</p>
<ul>
<li><code>RPUSH</code> and <code>ZADD</code> are both O(1) amortized operations.</li>
<li>Enqueueing tens of thousands of tasks per second is typically safe.</li>
<li>Avoid excessive serialization overhead in <code>toPayload(payload)</code>.</li>
</ul>
<p>Complexity:
Time: <code>O(1)</code> per item (both branches)<br>
Space: proportional to payload size stored in Redis.</p>
<p>Security:</p>
<ul>
<li>This method does not validate payload content, only structure.</li>
<li>Avoid untrusted raw strings that might interfere with deserialization in consumers.</li>
<li>Keys (<code>ready</code>, <code>delayed</code>) should always be built using <a href="#tokeystring" class="tsd-kind-method">toKeyString</a> to
maintain proper namespacing and safety.</li>
</ul>
</div><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-5">Throws<a href="#throws-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><code>&quot;Redis connection error.&quot;</code> if the client is disconnected.</li>
<li>Any error thrown by the underlying Redis client (<code>ZADD</code> or <code>RPUSH</code>).</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-47">Example<a href="#example-47" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example 1: Immediate enqueue</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">ready</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">readyKey</span><span class="hl-1">(</span><span class="hl-2">&#39;images&#39;</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">delayed</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">delayedKey</span><span class="hl-1">(</span><span class="hl-2">&#39;images&#39;</span><span class="hl-1">);</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">enqueue</span><span class="hl-1">(</span><span class="hl-5">ready</span><span class="hl-1">, </span><span class="hl-5">delayed</span><span class="hl-1">, { </span><span class="hl-5">id:</span><span class="hl-1"> </span><span class="hl-2">&#39;img123&#39;</span><span class="hl-1">, </span><span class="hl-5">resize:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1"> });</span><br/><span class="hl-3">// The job is now instantly available to workers.</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-48">Example<a href="#example-48" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example 2: Delayed enqueue (run after 10 seconds)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">ready</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">readyKey</span><span class="hl-1">(</span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">delayed</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">delayedKey</span><span class="hl-1">(</span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">);</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">enqueue</span><span class="hl-1">(</span><span class="hl-5">ready</span><span class="hl-1">, </span><span class="hl-5">delayed</span><span class="hl-1">, { </span><span class="hl-5">userId:</span><span class="hl-1"> </span><span class="hl-8">42</span><span class="hl-1">, </span><span class="hl-5">type:</span><span class="hl-1"> </span><span class="hl-2">&#39;welcome&#39;</span><span class="hl-1"> }, </span><span class="hl-8">10</span><span class="hl-1">);</span><br/><span class="hl-3">// The job will appear in the ready list once its scheduled time arrives.</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-49">Example<a href="#example-49" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example 3: Scheduling a chain of tasks dynamically</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">payload</span><span class="hl-1"> = { </span><span class="hl-5">step:</span><span class="hl-1"> </span><span class="hl-2">&#39;compress&#39;</span><span class="hl-1">, </span><span class="hl-5">source:</span><span class="hl-1"> </span><span class="hl-2">&#39;/tmp/a.jpg&#39;</span><span class="hl-1"> };</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">enqueue</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">readyKey</span><span class="hl-1">(</span><span class="hl-2">&#39;media&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">delayedKey</span><span class="hl-1">(</span><span class="hl-2">&#39;media&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-5">payload</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">Math</span><span class="hl-1">.</span><span class="hl-0">random</span><span class="hl-1">() * </span><span class="hl-8">60</span><span class="hl-1">, </span><span class="hl-3">// random delay up to 60s</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-18">Since<a href="#since-18" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-17">See<a href="#see-17" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#promotedelayed" class="tsd-kind-method">promoteDelayed</a> - Moves due delayed jobs into the ready list.</li>
<li>toPayload - Serializes the provided payload into a Redis-storable string.</li>
<li><a href="#reservemany" class="tsd-kind-method">reserveMany</a> - Consumes ready jobs for processing.</li>
<li>readyKey, delayedKey - Helpers for constructing valid key names.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L2054">PowerQueue.ts:2054</a></li></ul></aside></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Methods - Redis Key Helpers"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Methods - Redis Key Helpers</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="tokeystring"><span>to<wbr/>Key<wbr/>String</span><a href="#tokeystring" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="tokeystring-1"><span class="tsd-kind-call-signature">toKeyString</span><span class="tsd-signature-symbol">(</span><span class="tsd-signature-symbol">...</span><span class="tsd-kind-parameter">parts</span><span class="tsd-signature-symbol">:</span> (<span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">number</span>)<span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><a href="#tokeystring-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-signature-symbol">...</span><span class="tsd-kind-parameter">parts</span>: (<span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">number</span>)<span class="tsd-signature-symbol">[]</span></span><div class="tsd-comment tsd-typography"><p>Array of additional key segments (strings or numbers).
Each part is validated before being concatenated.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">string</span></h4><p>A fully qualified Redis key string in the format:
<code>queue:&lt;segment1&gt;:&lt;segment2&gt;:...</code></p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-19">Remarks<a href="#remarks-19" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This helper provides a consistent and safe way to construct Redis keys
used across all queue components - e.g., <code>ready</code>, <code>processing</code>, <code>delayed</code>, etc.</p>
<p>It delegates the actual validation and concatenation to the parent
PowerRedis.toKeyString method but automatically prefixes
all queue-related keys with the constant <code>&quot;queue&quot;</code>.</p>
<h3 id="validation-rules" class="tsd-anchor-link">Validation rules<a href="#validation-rules" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Disallows wildcard characters: <code>*</code>, <code>?</code>, <code>[</code>, <code>]</code></li>
<li>Disallows spaces and consecutive colons (<code>::</code>)</li>
<li>Ensures that each segment is a non-empty string or number</li>
<li>Joins valid segments with a single colon (<code>:</code>)</li>
</ul>
<p>For example, calling:</p>
<pre><code class="ts"><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">toKeyString</span><span class="hl-1">(</span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;ready&#39;</span><span class="hl-1">)</span>
</code><button type="button">Copy</button></pre>

<p>will produce the key:</p>
<pre><code><span class="hl-10">queue</span><span class="hl-1">:</span><span class="hl-10">emails</span><span class="hl-1">:</span><span class="hl-5">ready</span>
</code><button>Copy</button></pre>

<p>ensuring the <code>&quot;queue&quot;</code> namespace is always present, preventing collisions
with unrelated Redis data structures.</p>
<h3 id="why-this-matters" class="tsd-anchor-link">Why this matters<a href="#why-this-matters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Enforces a predictable key hierarchy for all queue data</li>
<li>Helps separate PowerQueue data from other Redis applications</li>
<li>Makes it easier to inspect and debug Redis keys (<code>SCAN queue:*</code>)</li>
<li>Guarantees key safety even when queue names come from dynamic inputs</li>
</ul>
</div><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-6">Throws<a href="#throws-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>If any segment fails validation (empty, contains forbidden characters,
or is otherwise invalid), an error will be thrown by the parent
PowerRedis.toKeyString method.</p>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-50">Example<a href="#example-50" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Build a key for the delayed list of the &quot;images&quot; queue</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">key</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">toKeyString</span><span class="hl-1">(</span><span class="hl-2">&#39;images&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;delayed&#39;</span><span class="hl-1">);</span><br/><span class="hl-3">// Result: &quot;queue:images:delayed&quot;</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-19">Since<a href="#since-19" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-18">See<a href="#see-18" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>PowerRedis.toKeyString - Base implementation handling validation.</li>
<li>readyKey - Uses this method to generate ready list keys.</li>
<li>processingKey - Uses this method for active processing keys.</li>
</ul>
</div></div><aside class="tsd-sources"><p>Overrides PowerRedis.toKeyString</p><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L467">PowerQueue.ts:467</a></li></ul></aside></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Methods - Reservation"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Methods - Reservation</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="reservemany"><span>reserve<wbr/>Many</span><a href="#reservemany" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="reservemany-1"><span class="tsd-kind-call-signature">reserveMany</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">source</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">processing</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">processingVt</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">limit</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">visibilitySec</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">&gt;</span><a href="#reservemany-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">source</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Ready list key (e.g., <code>queue:&lt;name&gt;</code>).</p>
</div></li><li><span><span class="tsd-kind-parameter">processing</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Processing list key (e.g., <code>queue:&lt;name&gt;:processing</code>).</p>
</div></li><li><span><span class="tsd-kind-parameter">processingVt</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Visibility-timeout ZSET key (e.g., <code>queue:&lt;name&gt;:processing:vt</code>).</p>
</div></li><li><span><span class="tsd-kind-parameter">limit</span>: <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 100</span></span><div class="tsd-comment tsd-typography"><p>Maximum number of items to move. <strong>Default:</strong> <code>100</code>.</p>
</div></li><li><span><span class="tsd-kind-parameter">visibilitySec</span>: <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 60</span></span><div class="tsd-comment tsd-typography"><p>Visibility timeout in seconds for newly reserved items. <strong>Default:</strong> <code>60</code>. Must be <code>&gt; 0</code>.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A list of <strong>raw item strings</strong> actually moved into processing (possibly empty).</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-20">Remarks<a href="#remarks-20" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This method is the primary high-throughput reservation path. It:</p>
<ol>
<li>Validates Redis connectivity and key/argument formats.</li>
<li>Ensures a compiled <strong>reserve Lua script</strong> is available via ensureReserveScript.</li>
<li>Tries <code>EVALSHA</code> using the <strong>LMOVE</strong> variant first (Redis ≥ 6.2), then <strong>RPOPLPUSH</strong> variant as a fallback.</li>
<li>On <code>NOSCRIPT</code>, <strong>reloads</strong> and retries once (see ensureReserveScript).</li>
<li>If scripting is unavailable, falls back to a <strong>client-side loop</strong> using moveOneToProcessing, then
batches <code>ZADD</code> operations to set the VT <strong>deadline</strong> for each moved item.</li>
</ol>
<p><strong>Visibility timeout (VT):</strong><br>
For each reserved item, a member is inserted into the <code>processingVt</code> ZSET with <code>score = now + visibilitySec</code>.
This prevents other consumers from seeing the item until either it is acknowledged
(removed by <a href="#ackprocessing" class="tsd-kind-method">ackProcessing</a>) or it expires and is requeued by <a href="#requeueexpired" class="tsd-kind-method">requeueExpired</a>.</p>
<p><strong>Preference order</strong></p>
<ol>
<li>Lua + <code>LMOVE LEFT→RIGHT</code> (true FIFO; Redis ≥ 6.2)</li>
<li>Lua + <code>RPOPLPUSH</code> (legacy fallback)</li>
<li>Client-side loop + batched <code>ZADD</code></li>
</ol>
</div><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-7">Throws<a href="#throws-7" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><code>&quot;Redis connection error.&quot;</code> if the client is not connected.</li>
<li><code>&quot;Key format error.&quot;</code> if any key is empty/invalid.</li>
<li><code>&quot;Limit/visibility format error.&quot;</code> if <code>limit</code> or <code>visibilitySec</code> are invalid.</li>
<li>Any error from the underlying Redis client during <code>evalsha</code> or transactions (re-thrown unless handled).</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-51">Example<a href="#example-51" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">ready</span><span class="hl-1">   = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">toKeyString</span><span class="hl-1">(</span><span class="hl-2">&#39;images&#39;</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">proc</span><span class="hl-1">    = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">toKeyString</span><span class="hl-1">(</span><span class="hl-2">&#39;images&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;processing&#39;</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">procVt</span><span class="hl-1">  = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">toKeyString</span><span class="hl-1">(</span><span class="hl-2">&#39;images&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;processing&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;vt&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-3">// Reserve up to 200 items with a 90-second visibility window</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">raws</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">reserveMany</span><span class="hl-1">(</span><span class="hl-5">ready</span><span class="hl-1">, </span><span class="hl-5">proc</span><span class="hl-1">, </span><span class="hl-5">procVt</span><span class="hl-1">, </span><span class="hl-8">200</span><span class="hl-1">, </span><span class="hl-8">90</span><span class="hl-1">);</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Reserved </span><span class="hl-6">${</span><span class="hl-5">raws</span><span class="hl-11">.</span><span class="hl-5">length</span><span class="hl-6">}</span><span class="hl-2"> items`</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-20">Since<a href="#since-20" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-19">See<a href="#see-19" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>ensureReserveScript - Preloads LMOVE/RPOPLPUSH Lua variants and caches SHAs.</li>
<li>moveOneToProcessing - Client-side single-item fallback when Lua isn’t available.</li>
<li><a href="#ackprocessing" class="tsd-kind-method">ackProcessing</a> - Acknowledges success and removes VT entries.</li>
<li><a href="#requeueexpired" class="tsd-kind-method">requeueExpired</a> - Scans <code>processing:vt</code> and requeues expired items.</li>
<li>getReserveScriptLMOVE | getReserveScriptRPOPLPUSH - The Lua scripts used here.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L1519">PowerQueue.ts:1519</a></li></ul></aside></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Methods - Scheduling & Delays"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Methods - Scheduling &amp; Delays</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="promotedelayed"><span>promote<wbr/>Delayed</span><a href="#promotedelayed" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="promotedelayed-1"><span class="tsd-kind-call-signature">promoteDelayed</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">delayed</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">ready</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">nowTs</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">chunk</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">&gt;</span><a href="#promotedelayed-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">delayed</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Redis <strong>ZSET</strong> key storing delayed members (<code>score = readyAt UNIX seconds</code>).</p>
</div></li><li><span><span class="tsd-kind-parameter">ready</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Redis <strong>LIST</strong> key where due items are appended for immediate processing.</p>
</div></li><li><span><code class="tsd-tag">Optional</code><span class="tsd-kind-parameter">nowTs</span>: <span class="tsd-signature-type">number</span></span><div class="tsd-comment tsd-typography"><p>Optional UNIX timestamp (seconds) used as the cutoff for “due”.<br>
{Default: current time (via nowSec)}</p>
</div></li><li><span><span class="tsd-kind-parameter">chunk</span>: <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 1000</span></span><div class="tsd-comment tsd-typography"><p>Maximum number of items to promote in this batch.<br>
{Default: 1000}</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">&gt;</span></h4><p>Resolves to the <strong>number of delayed items promoted</strong> into the ready list (0 if none).</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-21">Remarks<a href="#remarks-21" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Delayed jobs are stored in a ZSET where each member is the serialized task (<strong>raw</strong>),
and the <strong>score</strong> is the UNIX timestamp (in seconds) when the task becomes eligible
to run. This method moves up to <code>chunk</code> due members (score <code>≤ now</code>) into the ready
list so workers can reserve and process them.</p>
<p>It has two execution paths:</p>
<ol>
<li>
<p><strong>Fast-path (Lua; atomic; single round-trip):</strong><br>
Uses evalshaWithReload to run the cached script from getPromoteScript.
The script:</p>
<ul>
<li><code>ZRANGEBYSCORE delayed 0 now LIMIT 0 chunk</code> → due members</li>
<li>For each member <code>m</code>: <code>ZREM delayed m</code>; <code>RPUSH ready m</code></li>
<li>Returns the count of promoted items.</li>
</ul>
</li>
<li>
<p><strong>Fallback (client-side; transactional):</strong><br>
If Lua isn’t available or <code>NOSCRIPT</code> reload ultimately fails, it:</p>
<ul>
<li>Reads <code>due</code> via <code>ZRANGEBYSCORE</code>,</li>
<li>Executes a <code>MULTI/EXEC</code> removing each from <code>delayed</code> and <code>RPUSH</code>-ing to <code>ready</code>,</li>
<li>Returns the number of promoted items.</li>
</ul>
</li>
</ol>
<p><strong>Ordering notes</strong></p>
<ul>
<li>Within a single call, items are appended to <code>ready</code> in the order returned by
<code>ZRANGEBYSCORE</code> (sorted by score, then lexicographically for ties).</li>
<li>Producers typically <code>RPUSH</code> into <code>ready</code>, and consumers <code>LMOVE LEFT→RIGHT</code>, preserving FIFO.</li>
</ul>
<p>Performance:</p>
<ul>
<li><strong>Lua path:</strong> one atomic server-side operation; best under high concurrency.</li>
<li><strong>Fallback path:</strong> one range read + one <code>MULTI/EXEC</code> write; still efficient for moderate loads.</li>
<li>Tune <code>chunk</code> to balance latency and fairness across queues.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>Per batch: <code>ZRANGEBYSCORE</code> + (<code>ZREM</code> <code>O(log n)</code> + <code>RPUSH</code> <code>O(1)</code>) per promoted member.</li>
<li>Overall approx: <code>O(k * log n)</code> for <code>k ≤ chunk</code> (ignoring LIST append cost).</li>
</ul>
<p>Security:</p>
<ul>
<li>Keys should come from <a href="#tokeystring" class="tsd-kind-method">toKeyString</a> to avoid unsafe key names.</li>
<li><code>raw</code> payloads originate from <code>enqueue()</code> and internal flows (not user input).</li>
</ul>
<p>Notes:</p>
<ul>
<li><code>nowTs</code> defaults to the worker’s current UNIX seconds via nowSec.</li>
<li>Safe under concurrent callers: Redis atomicity ensures a due member is promoted once.</li>
<li>After promotion, tasks will be discoverable by <a href="#reservemany" class="tsd-kind-method">reserveMany</a> on the next iteration.</li>
</ul>
</div><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-8">Throws<a href="#throws-8" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><code>&quot;Redis connection error.&quot;</code> if the client is not connected.</li>
<li>Any error surfaced by the underlying Redis client (Lua path or fallback transaction).</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-52">Example<a href="#example-52" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Periodic promotion in the worker loop:</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">promoted</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">promoteDelayed</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">delayedKey</span><span class="hl-1">(</span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">readyKey</span><span class="hl-1">(</span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">);</span><br/><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">promoted</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Promoted </span><span class="hl-6">${</span><span class="hl-5">promoted</span><span class="hl-6">}</span><span class="hl-2"> delayed email tasks`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-53">Example<a href="#example-53" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Testing with a fixed timestamp and a smaller batch:</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">now</span><span class="hl-1"> = </span><span class="hl-5">Math</span><span class="hl-1">.</span><span class="hl-0">floor</span><span class="hl-1">(</span><span class="hl-5">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() / </span><span class="hl-8">1000</span><span class="hl-1">);</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">promoteDelayed</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">delayedKey</span><span class="hl-1">(</span><span class="hl-2">&#39;reports&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">readyKey</span><span class="hl-1">(</span><span class="hl-2">&#39;reports&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-5">now</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">200</span><span class="hl-1">,</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-21">Since<a href="#since-21" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-20">See<a href="#see-20" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>getPromoteScript for the atomic Lua implementation.</li>
<li>evalshaWithReload for robust <code>EVALSHA</code> execution with auto-reload on <code>NOSCRIPT</code>.</li>
<li><a href="#enqueue" class="tsd-kind-method">enqueue</a> to schedule delayed tasks (by passing <code>delaySec &gt; 0</code>).</li>
<li><a href="#reservemany" class="tsd-kind-method">reserveMany</a> to reserve items from <code>ready</code> into <code>processing</code>.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L1915">PowerQueue.ts:1915</a></li></ul></aside></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Methods - Task Construction"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Methods - Task Construction</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="buildtask"><span>build<wbr/>Task</span><a href="#buildtask" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="buildtask-1"><span class="tsd-kind-call-signature">buildTask</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">data</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Partial</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><a href="#buildtask-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">data</span>: <span class="tsd-signature-type">Partial</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a><span class="tsd-signature-symbol">&gt;</span></span><div class="tsd-comment tsd-typography"><p>Partial <code>Task</code> input containing any subset of fields.<br>
Must include a valid <code>queueName</code>. Other fields are optional.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <a href="../types/Task.html" class="tsd-signature-type tsd-kind-type-alias">Task</a></h4><p>A complete, normalized <a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> object ready to enqueue or process.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-22">Remarks<a href="#remarks-22" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This method takes a possibly incomplete <code>Partial&lt;Task&gt;</code> structure and produces
a ready-to-use <code>Task</code> instance with guaranteed type safety and well-defined
metadata. It is typically used by <a href="#addtask" class="tsd-kind-method">addTask</a> before enqueuing jobs into Redis.</p>
<p>The function:</p>
<ol>
<li>Validates the input structure and <code>queueName</code>.</li>
<li>Generates unique <code>uuid()</code> values for missing <code>id</code> and <code>iterationId</code>.</li>
<li>Ensures numerical and object fields have correct default values.</li>
<li>Initializes <code>progress</code> and <code>chain</code> substructures to track execution lifecycle.</li>
</ol>
<h3 id="field-initialization-logic" class="tsd-anchor-link">Field initialization logic<a href="#field-initialization-logic" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Field</th>
<th>Source</th>
<th>Default / Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>queueName</code></td>
<td>Required</td>
<td>Throws if missing or invalid.</td>
</tr>
<tr>
<td><code>iterationId</code></td>
<td><code>data.iterationId</code> or new <code>uuid()</code></td>
<td>Groups all related subtasks in a batch run.</td>
</tr>
<tr>
<td><code>iterationLength</code></td>
<td><code>Number(data.iterationLength)</code></td>
<td>Defaults to 0 if absent.</td>
</tr>
<tr>
<td><code>id</code></td>
<td><code>data.id</code> or new <code>uuid()</code></td>
<td>Unique job identifier.</td>
</tr>
<tr>
<td><code>maxAttempts</code></td>
<td><code>data.maxAttempts</code> or <code>this.maxAttempts</code></td>
<td>Max retry count before permanent fail.</td>
</tr>
<tr>
<td><code>currentAttempt</code></td>
<td><code>data.currentAttempt</code> or 0</td>
<td>Starts from 0 for new jobs.</td>
</tr>
<tr>
<td><code>chain</code></td>
<td><code>data.chain</code> if valid (<code>queues[]</code>, <code>index</code>)</td>
<td>Defaults to <code>{ queues: [], index: 0 }</code>.</td>
</tr>
<tr>
<td><code>payload</code></td>
<td><code>data.payload</code> or <code>{}</code></td>
<td>User-provided job content.</td>
</tr>
<tr>
<td><code>progress</code></td>
<td>merged from <code>data.progress</code></td>
<td>Tracks timing and retry metadata.</td>
</tr>
<tr>
<td><code>result</code></td>
<td><code>data.result</code> or <code>{}</code></td>
<td>Result container for execution outputs.</td>
</tr>
</tbody>
</table>
<h3 id="example-of-resulting-structure" class="tsd-anchor-link">Example of resulting structure<a href="#example-of-resulting-structure" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-10">queueName</span><span class="hl-1">: </span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">iterationId</span><span class="hl-1">: </span><span class="hl-2">&#39;b23f1a...uuid&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">iterationLength</span><span class="hl-1">: </span><span class="hl-8">100</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">id</span><span class="hl-1">: </span><span class="hl-2">&#39;c93e4a...uuid&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">maxAttempts</span><span class="hl-1">: </span><span class="hl-8">3</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">currentAttempt</span><span class="hl-1">: </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-10">chain</span><span class="hl-1">: { </span><span class="hl-10">queues</span><span class="hl-1">: [</span><span class="hl-2">&#39;emails:send&#39;</span><span class="hl-1">, </span><span class="hl-2">&#39;emails:log&#39;</span><span class="hl-1">], </span><span class="hl-10">index</span><span class="hl-1">: </span><span class="hl-8">0</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-10">payload</span><span class="hl-1">: { </span><span class="hl-10">userId</span><span class="hl-1">: </span><span class="hl-8">42</span><span class="hl-1">, </span><span class="hl-10">subject</span><span class="hl-1">: </span><span class="hl-2">&#39;Welcome!&#39;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-10">progress</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-10">createdAt</span><span class="hl-1">: </span><span class="hl-8">1730000000000</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">successAt</span><span class="hl-1">: </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">errorAt</span><span class="hl-1">: </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">failAt</span><span class="hl-1">: </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">fatalAt</span><span class="hl-1">: </span><span class="hl-8">0</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">retries</span><span class="hl-1">: [],</span><br/><span class="hl-1">    </span><span class="hl-10">chain</span><span class="hl-1">: []</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-10">result</span><span class="hl-1">: {}</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>Notes:</p>
<ul>
<li>The function uses runtime guards from <code>full-utils</code> (e.g., <code>isStrFilled</code>, <code>isNumPZ</code>)<br>
to ensure data consistency and prevent malformed tasks from entering Redis.</li>
<li>Timestamps in <code>progress</code> use milliseconds (<code>Date.now()</code>), unlike Redis timestamps,
which use seconds (see nowSec).</li>
<li>The <code>chain</code> mechanism supports queue chaining; see <a href="#onchainsuccess" class="tsd-kind-method">onChainSuccess</a>.</li>
</ul>
<p>Performance:</p>
<ul>
<li>Purely in-memory and synchronous; negligible cost.</li>
<li>Safe to call thousands of times per second when enqueueing tasks.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>Time: <code>O(1)</code> (simple property normalization)</li>
<li>Space: proportional to payload + metadata (~0.5 KB typical)</li>
</ul>
<p>Security:</p>
<ul>
<li>No direct Redis interaction; safe for untrusted payloads (they are serialized later).</li>
<li>Still, avoid passing non-serializable objects in <code>payload</code>.</li>
</ul>
</div><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-9">Throws<a href="#throws-9" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><code>&quot;Data property is not valid.&quot;</code> if input is not a non-empty object.</li>
<li><code>&quot;Queue name is not valid.&quot;</code> if <code>queueName</code> is missing or empty.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-54">Example<a href="#example-54" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Minimal example: queue name only</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">t</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">buildTask</span><span class="hl-1">({ </span><span class="hl-5">queueName:</span><span class="hl-1"> </span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1"> });</span><br/><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-5">t</span><span class="hl-1">.</span><span class="hl-5">id</span><span class="hl-1">, </span><span class="hl-5">t</span><span class="hl-1">.</span><span class="hl-5">queueName</span><span class="hl-1">);</span><br/><span class="hl-3">// → automatically assigned UUIDs, safe defaults</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-55">Example<a href="#example-55" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Example with custom retry and payload</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">task</span><span class="hl-1"> = </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">buildTask</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">queueName:</span><span class="hl-1"> </span><span class="hl-2">&#39;resize&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">maxAttempts:</span><span class="hl-1"> </span><span class="hl-8">5</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">payload:</span><span class="hl-1"> { </span><span class="hl-5">src:</span><span class="hl-1"> </span><span class="hl-2">&#39;/tmp/img.jpg&#39;</span><span class="hl-1">, </span><span class="hl-5">width:</span><span class="hl-1"> </span><span class="hl-8">400</span><span class="hl-1"> },</span><br/><span class="hl-1">});</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">addTask</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">); </span><span class="hl-3">// enqueue to Redis</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-22">Since<a href="#since-22" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-21">See<a href="#see-21" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#addtask" class="tsd-kind-method">addTask</a> - Wraps this function to enqueue tasks.</li>
<li><a href="../types/Task.html" class="tsd-kind-type-alias">Task</a> - Full type definition.</li>
<li><a href="../types/TaskChain.html" class="tsd-kind-type-alias">TaskChain</a>, <a href="../types/TaskProgress.html" class="tsd-kind-type-alias">TaskProgress</a> - Substructures initialized here.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L2437">PowerQueue.ts:2437</a></li></ul></aside></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Methods - Time & Visibility"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Methods - Time &amp; Visibility</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="extendvisibility"><span>extend<wbr/>Visibility</span><a href="#extendvisibility" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="extendvisibility-1"><span class="tsd-kind-call-signature">extendVisibility</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">processingVt</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">raw</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">visibilitySec</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span><a href="#extendvisibility-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">processingVt</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Redis <strong>ZSET</strong> key that tracks visibility deadlines for in-flight items.</p>
</div></li><li><span><span class="tsd-kind-parameter">raw</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The exact serialized task payload (ZSET member) whose VT should be extended.</p>
</div></li><li><span><span class="tsd-kind-parameter">visibilitySec</span>: <span class="tsd-signature-type">number</span></span><div class="tsd-comment tsd-typography"><p>Desired VT extension <strong>in seconds</strong>; clamped to a minimum of <code>1</code>.</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></h4><p><code>Promise&lt;void&gt;</code> - resolves after attempting to update the deadline.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-23">Remarks<a href="#remarks-23" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>When a task is reserved, its serialized payload (<strong>raw</strong>) is inserted into
the <code>processing:vt</code> <strong>ZSET</strong> with a score equal to the timestamp at which its
visibility expires. If the worker needs more time to finish the task,
the VT must be <strong>renewed</strong> to prevent the job from being considered expired
and <strong>requeued</strong> by <a href="#requeueexpired" class="tsd-kind-method">requeueExpired</a>.</p>
<p>This method computes a new deadline as:</p>
<pre><code><span class="hl-5">deadline</span><span class="hl-1"> = </span><span class="hl-0">nowSec</span><span class="hl-1">() + </span><span class="hl-0">max</span><span class="hl-1">(</span><span class="hl-8">1</span><span class="hl-1">, </span><span class="hl-5">visibilitySec</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>

<p>and writes it using zaddCompatXXCH, a compatibility helper that tries:</p>
<ul>
<li><code>ZADD key XX CH score member</code> (preferred modern form),</li>
<li>then <code>ZADD key CH XX score member</code> (some clients swap argument order),</li>
<li>finally falls back to legacy <code>ZADD key score member</code> (no <code>XX</code>/<code>CH</code>).</li>
</ul>
<p><strong>Semantics</strong></p>
<ul>
<li>The ZSET <strong>member</strong> is the exact <code>raw</code> payload string reserved earlier.</li>
<li>The ZSET <strong>score</strong> is the UNIX timestamp (seconds) when the item expires.</li>
<li>Renewing the score postpones expiration, keeping the item <strong>invisible</strong> to other workers.</li>
</ul>
<p><strong>Typical usage</strong></p>
<ul>
<li>Called periodically by startHeartbeat (every ~40% of VT) so the deadline
is extended well before expiry.</li>
<li>Can also be invoked manually if a long-running step is anticipated.</li>
</ul>
<p>Performance:</p>
<ul>
<li><code>ZADD ... XX</code> is <code>O(log n)</code>; a single write per heartbeat interval is inexpensive.</li>
<li>Using a heartbeat period shorter than the VT (e.g., 30–50%) provides a safety buffer
against transient stalls and GC pauses.</li>
</ul>
<p>Complexity:
Time: <code>O(log n)</code> per update (ZSET reindex)<br>
Space: <code>O(1)</code> (overwrites the member’s score)</p>
<p>Security:</p>
<ul>
<li><code>processingVt</code> should be produced by processingVtKey to ensure safe namespacing.</li>
<li><code>raw</code> must be the exact string stored during reservation; do not pass untrusted strings.</li>
</ul>
<p>Notes:</p>
<ul>
<li>A minimum of <strong>1 second</strong> is enforced for <code>visibilitySec</code> to avoid immediate expiry.</li>
<li>The compatibility helper swallows transient client differences; if all attempts fail,
the VT may not be extended, and the item could expire and be requeued by
<a href="#requeueexpired" class="tsd-kind-method">requeueExpired</a>. The method itself is resilient and typically does not throw.</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-56">Example<a href="#example-56" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Manual VT extension (e.g., before a long step):</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">extendVisibility</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">processingVtKey</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">.</span><span class="hl-5">queueName</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-5">processingRaw</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">.</span><span class="hl-5">id</span><span class="hl-1">)!,</span><br/><span class="hl-1">  </span><span class="hl-8">120</span><span class="hl-1">, </span><span class="hl-3">// extend by 2 minutes</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-57">Example<a href="#example-57" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Automatic usage inside the heartbeat:</span><br/><span class="hl-3">// (startHeartbeat schedules calls to extendVisibility at safe intervals)</span><br/><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">startHeartbeat</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-23">Since<a href="#since-23" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-22">See<a href="#see-22" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>startHeartbeat - Periodically calls this to keep tasks invisible.</li>
<li><a href="#requeueexpired" class="tsd-kind-method">requeueExpired</a> - Requeues tasks whose VT has elapsed.</li>
<li>zaddCompatXXCH - Compatibility wrapper for robust <code>ZADD</code> usage.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L2149">PowerQueue.ts:2149</a></li></ul></aside></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Methods - Visibility & Recovery"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Methods - Visibility &amp; Recovery</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="requeueexpired"><span>requeue<wbr/>Expired</span><a href="#requeueexpired" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="requeueexpired-1"><span class="tsd-kind-call-signature">requeueExpired</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">processing</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">processingVt</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">ready</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">nowTs</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">chunk</span><span class="tsd-signature-symbol">?:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">&gt;</span><a href="#requeueexpired-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">processing</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Redis <strong>LIST</strong> key holding currently reserved (in-flight) items.</p>
</div></li><li><span><span class="tsd-kind-parameter">processingVt</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Redis <strong>ZSET</strong> key that stores visibility deadlines (score = UNIX seconds).</p>
</div></li><li><span><span class="tsd-kind-parameter">ready</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>Redis <strong>LIST</strong> key to which expired items are requeued for retry.</p>
</div></li><li><span><code class="tsd-tag">Optional</code><span class="tsd-kind-parameter">nowTs</span>: <span class="tsd-signature-type">number</span></span><div class="tsd-comment tsd-typography"><p>Optional UNIX timestamp (seconds) used as the “current time” cutoff.
If omitted, the method uses nowSec. {Default: current time}</p>
</div></li><li><span><span class="tsd-kind-parameter">chunk</span>: <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol"> = 1000</span></span><div class="tsd-comment tsd-typography"><p>Maximum number of expired items to move in this batch.<br>
{Default: 1000}</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">&gt;</span></h4><p>Resolves to the <strong>number of items requeued</strong> (0 if none were due).</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-24">Remarks<a href="#remarks-24" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>In PowerQueue, a reserved task is moved from the ready list into the processing list
and recorded in a visibility-timeout ZSET (<code>processing:vt</code>) where the <strong>score</strong> is
the UNIX timestamp (seconds) when the task should become visible again if it
wasn’t acknowledged.</p>
<p>This method performs that <strong>visibility recovery</strong> in two stages:</p>
<ol>
<li>
<p><strong>Fast-path (Lua, atomic, single round-trip):</strong><br>
Executes the cached Lua script (see getRequeueScript) via
evalshaWithReload. The script:</p>
<ul>
<li>finds expired members with <code>ZRANGEBYSCORE processing:vt 0 now LIMIT 0 chunk</code>,</li>
<li>for each member <code>m</code>: <code>ZREM processing:vt m</code>, <code>LREM processing 1 m</code>, <code>RPUSH ready m</code>,</li>
<li>returns the number of requeued items.</li>
</ul>
</li>
<li>
<p><strong>Fallback (client-side):</strong><br>
If scripting is unavailable or returns <code>NOSCRIPT</code> and reload fails, it:</p>
<ul>
<li>reads expired members with <code>ZREANGEBYSCORE</code>,</li>
<li>removes them from <em>processing</em> and <em>processing:vt</em>,</li>
<li>appends them to <em>ready</em>,</li>
<li>all within a single <code>MULTI/EXEC</code> transaction.</li>
</ul>
</li>
</ol>
<p>The operation is <strong>idempotent</strong> with respect to each raw payload value: if a member
does not exist in one of the structures, the corresponding Redis command is a no-op.</p>
<hr>
<h3 id="when-to-call" class="tsd-anchor-link">When to call<a href="#when-to-call" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The worker loop periodically calls this method to ensure that <strong>stalled</strong> or <strong>crashed</strong>
workers do not permanently “hold” tasks. Any job that outlives its visibility window
becomes eligible for retry and is returned to the <em>ready</em> list.</p>
<p>Performance:</p>
<ul>
<li><strong>Lua path:</strong> one server-side atomic loop → typically the fastest and safest under load.</li>
<li><strong>Fallback path:</strong> one <code>Z*</code> read + a batched <code>MULTI/EXEC</code> write round-trip.</li>
<li>Choose a sensible <code>chunk</code> that balances latency and fairness across queues.</li>
</ul>
<p>Complexity:</p>
<ul>
<li>Lua: <code>ZRANGEBYSCORE</code> + <code>ZREM</code> per item (<code>O(log n)</code>) + <code>LREM</code> list scan (<code>O(n)</code> worst-case) + <code>RPUSH</code> (<code>O(1)</code>).</li>
<li>Fallback: same primitives executed via client-side transaction.</li>
<li>Overall per batch: approximately <code>O(k * (log n + n_list))</code>, where <code>k ≤ chunk</code>.</li>
</ul>
<p>Security:</p>
<ul>
<li>Keys are expected to be generated by <a href="#tokeystring" class="tsd-kind-method">toKeyString</a>; do not pass user-controlled
arbitrary key names. Raw members originate from <code>enqueue()</code>/reservation.</li>
</ul>
<p>Notes:</p>
<ul>
<li><code>nowTs</code> defaults to the worker’s current UNIX seconds; provide it explicitly only
for testing or custom scheduling.</li>
<li>If multiple workers run this concurrently, Redis atomicity ensures each expired
item is requeued <strong>once</strong>.</li>
<li>Items requeued here will be picked up again by <code>reserveMany()</code> and retried according
to your backoff policy.</li>
</ul>
</div><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-10">Throws<a href="#throws-10" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><code>&quot;Redis connection error.&quot;</code> if the client is not connected.</li>
<li>Any error surfaced by the underlying Redis client (Lua path or fallback transaction).</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-58">Example<a href="#example-58" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Typical periodic call inside a worker loop:</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">moved</span><span class="hl-1"> = </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">requeueExpired</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">processingKey</span><span class="hl-1">(</span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">processingVtKey</span><span class="hl-1">(</span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">readyKey</span><span class="hl-1">(</span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">);</span><br/><span class="hl-4">if</span><span class="hl-1"> (</span><span class="hl-5">moved</span><span class="hl-1"> &gt; </span><span class="hl-8">0</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Recovered </span><span class="hl-6">${</span><span class="hl-5">moved</span><span class="hl-6">}</span><span class="hl-2"> expired tasks back to ready.`</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-59">Example<a href="#example-59" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="ts"><span class="hl-3">// Testing with a fixed timestamp and smaller chunk:</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">now</span><span class="hl-1"> = </span><span class="hl-5">Math</span><span class="hl-1">.</span><span class="hl-0">floor</span><span class="hl-1">(</span><span class="hl-5">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() / </span><span class="hl-8">1000</span><span class="hl-1">);</span><br/><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">requeueExpired</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">processingKey</span><span class="hl-1">(</span><span class="hl-2">&#39;reports&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">processingVtKey</span><span class="hl-1">(</span><span class="hl-2">&#39;reports&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">readyKey</span><span class="hl-1">(</span><span class="hl-2">&#39;reports&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-5">now</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">100</span><span class="hl-1">,</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-24">Since<a href="#since-24" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>2.0.0</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-23">See<a href="#see-23" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>getRequeueScript for the atomic server-side implementation.</li>
<li>evalshaWithReload for robust <code>EVALSHA</code> execution with <code>NOSCRIPT</code> recovery.</li>
<li><a href="#reservemany" class="tsd-kind-method">reserveMany</a> for how items enter <em>processing</em> / <em>processing:vt</em>.</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/ihor-bielchenko/power-queues/blob/7de6b8b458789a4b752b6dcc45c0d41a0481695e/src/PowerQueue.ts#L1787">PowerQueue.ts:1787</a></li></ul></aside></div></li></ul></section></section></details></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#key-design-points"><span>Key design points</span></a><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Constructors"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Constructors</summary><div><a href="#constructor"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Constructor"><use href="../assets/icons.svg#icon-512"></use></svg><span>constructor</span></a></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Properties"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Properties</summary><div><a href="#concurrency"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>concurrency</span></a><a href="#expirestatussec"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>expire<wbr/>Status<wbr/>Sec</span></a><a href="#iterationtimeout"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>iteration<wbr/>Timeout</span></a><a href="#maxattempts"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>max<wbr/>Attempts</span></a><a href="#portionlength"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>portion<wbr/>Length</span></a><a href="#retrybasesec"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>retry<wbr/>Base<wbr/>Sec</span></a><a href="#retrymaxsec"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>retry<wbr/>Max<wbr/>Sec</span></a><a href="#visibilitytimeoutsec"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Property"><use href="../assets/icons.svg#icon-1024"></use></svg><span>visibility<wbr/>Timeout<wbr/>Sec</span></a></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Methods - Acknowledgement"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Methods - Acknowledgement</summary><div><a href="#ackprocessing"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>ack<wbr/>Processing</span></a><ul><li><a href="#why-a-transaction"><span>Why a transaction?</span></a></li></ul></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Methods - Core Business Logic"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Methods - Core Business Logic</summary><div><a href="#execute"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>execute</span></a><ul><li><a href="#responsibilities"><span>Responsibilities</span></a></li><li><a href="#error-handling"><span>Error handling</span></a></li><li><a href="#best-practices"><span>Best practices</span></a></li><li><a href="#typical-use-cases"><span>Typical use cases</span></a></li></ul></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Methods - Execution Loop"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Methods - Execution Loop</summary><div><a href="#iteration"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>iteration</span></a></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Methods - Lifecycle"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Methods - Lifecycle</summary><div><a href="#run"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>run</span></a><a href="#stop"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>stop</span></a><ul><li><a href="#behavior-summary"><span>Behavior summary</span></a></li><li><a href="#why-it-matters"><span>Why it matters</span></a></li></ul></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Methods - Lifecycle Hooks"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Methods - Lifecycle Hooks</summary><div><a href="#afterexecution"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>after<wbr/>Execution</span></a><ul><li><ul><li><ul><li><a href="#execution-flow"><span>Execution flow</span></a></li><li><a href="#typical-use-cases-1"><span>Typical use cases</span></a></li></ul></li></ul></li></ul><a href="#afteriterationexecution"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>after<wbr/>Iteration<wbr/>Execution</span></a><ul><li><ul><li><ul><li><a href="#example-workflow"><span>Example workflow</span></a></li><li><a href="#typical-use-cases-2"><span>Typical use cases</span></a></li></ul></li></ul></li></ul><a href="#beforeexecution"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>before<wbr/>Execution</span></a><ul><li><ul><li><ul><li><a href="#execution-flow-1"><span>Execution flow</span></a></li><li><a href="#typical-use-cases-3"><span>Typical use cases</span></a></li></ul></li></ul></li></ul><a href="#beforeiterationexecution"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>before<wbr/>Iteration<wbr/>Execution</span></a><ul><li><ul><li><ul><li><a href="#typical-use-cases-4"><span>Typical use cases</span></a></li></ul></li></ul></li></ul><a href="#onchainsuccess"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>on<wbr/>Chain<wbr/>Success</span></a><ul><li><ul><li><ul><li><a href="#chain-success-flow"><span>Chain success flow</span></a></li><li><a href="#behavior"><span>Behavior</span></a></li><li><a href="#typical-use-cases-5"><span>Typical use cases</span></a></li></ul></li></ul></li></ul><a href="#onerror"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>on<wbr/>Error</span></a><ul><li><ul><li><ul><li><a href="#error-propagation-flow"><span>Error propagation flow</span></a></li><li><a href="#behavior-1"><span>Behavior</span></a></li><li><a href="#typical-use-cases-6"><span>Typical use cases</span></a></li></ul></li></ul></li></ul><a href="#onfail"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>on<wbr/>Fail</span></a><ul><li><ul><li><ul><li><a href="#failure-flow"><span>Failure flow</span></a></li><li><a href="#behavior-2"><span>Behavior</span></a></li><li><a href="#typical-use-cases-7"><span>Typical use cases</span></a></li></ul></li></ul></li></ul><a href="#onfatal"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>on<wbr/>Fatal</span></a><ul><li><ul><li><ul><li><a href="#fatal-error-flow"><span>Fatal error flow</span></a></li><li><a href="#behavior-3"><span>Behavior</span></a></li><li><a href="#typical-use-cases-8"><span>Typical use cases</span></a></li></ul></li></ul></li></ul><a href="#oniterationerror"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>on<wbr/>Iteration<wbr/>Error</span></a><ul><li><ul><li><ul><li><a href="#iteration-error-flow"><span>Iteration error flow</span></a></li><li><a href="#behavior-4"><span>Behavior</span></a></li><li><a href="#typical-use-cases-9"><span>Typical use cases</span></a></li></ul></li></ul></li></ul><a href="#onretry"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>on<wbr/>Retry</span></a><ul><li><ul><li><ul><li><a href="#retry-workflow"><span>Retry workflow</span></a></li><li><a href="#timing-semantics"><span>Timing &amp; semantics</span></a></li><li><a href="#typical-use-cases-10"><span>Typical use cases</span></a></li></ul></li></ul></li></ul><a href="#onsuccess"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>on<wbr/>Success</span></a><ul><li><a href="#success-flow"><span>Success flow</span></a></li><li><a href="#behavior-5"><span>Behavior</span></a></li><li><a href="#typical-use-cases-11"><span>Typical use cases</span></a></li></ul></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Methods - Queue Production"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Methods - Queue Production</summary><div><a href="#addtask"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>add<wbr/>Task</span></a><ul><li><ul><li><ul><li><a href="#behavior-summary-1"><span>Behavior summary</span></a></li></ul></li></ul></li></ul><a href="#enqueue"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>enqueue</span></a><ul><li><a href="#behavior-summary-2"><span>Behavior summary</span></a></li><li><a href="#typical-lifecycle"><span>Typical lifecycle</span></a></li></ul></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Methods - Redis Key Helpers"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Methods - Redis Key Helpers</summary><div><a href="#tokeystring"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>to<wbr/>Key<wbr/>String</span></a><ul><li><a href="#validation-rules"><span>Validation rules</span></a></li><li><a href="#why-this-matters"><span>Why this matters</span></a></li></ul></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Methods - Reservation"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Methods - Reservation</summary><div><a href="#reservemany"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>reserve<wbr/>Many</span></a></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Methods - Scheduling & Delays"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Methods - Scheduling &amp; Delays</summary><div><a href="#promotedelayed"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>promote<wbr/>Delayed</span></a></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Methods - Task Construction"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Methods - Task Construction</summary><div><a href="#buildtask"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>build<wbr/>Task</span></a><ul><li><a href="#field-initialization-logic"><span>Field initialization logic</span></a></li><li><a href="#example-of-resulting-structure"><span>Example of resulting structure</span></a></li></ul></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Methods - Time & Visibility"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Methods - Time &amp; Visibility</summary><div><a href="#extendvisibility"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>extend<wbr/>Visibility</span></a></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Methods - Visibility & Recovery"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Methods - Visibility &amp; Recovery</summary><div><a href="#requeueexpired"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>requeue<wbr/>Expired</span></a><ul><li><a href="#when-to-call"><span>When to call</span></a></li></ul></div></details></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">power-queues API Docs - v2.0.0</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
