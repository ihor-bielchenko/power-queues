<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>power-queues API Docs - v2.0.0</title><meta name="description" content="Documentation for power-queues API Docs"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">power-queues API Docs - v2.0.0</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>power-queues API Docs - v2.0.0</h1></div><div class="tsd-panel tsd-typography"><h1 id="power-queues" class="tsd-anchor-link">power-queues<a href="#power-queues" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>A production-ready, <strong>Redis-backed queue runner</strong> with visibility timeouts, delayed scheduling, chainable queues, retries with exponential backoff + jitter, and heartbeat renewals ‚Äî built on top of a thin <code>PowerRedis</code> abstraction.</p>
<p>This module exposes a base abstract class PowerQueue which you extend and implement. It supports:</p>
<ul>
<li>FIFO reservation (<code>LMOVE LEFT-&gt;RIGHT</code> preferred, <code>RPOPLPUSH</code> fallback) via Lua scripts or client loop.</li>
<li><strong>Visibility timeout (VT)</strong> with periodic heartbeat (ZSET scores store deadlines).</li>
<li><strong>Delayed tasks</strong> (ZSET with future timestamps) and promotion to ready list.</li>
<li><strong>Retry policy</strong> with exponential backoff + jitter and a <strong>fail</strong> queue after max attempts.</li>
<li><strong>Chain mode</strong>: automatically forward a task through a list of queues and call lifecycle hooks.</li>
<li>Iteration loop with promote/requeue passes, concurrency slicing, and status counters with TTL.</li>
</ul>
<p>It provides the core logic for <strong>visibility timeouts</strong>, <strong>task retries</strong>, <strong>delayed scheduling</strong>, <strong>chain forwarding</strong>, and <strong>concurrent workers</strong> ‚Äî without any external dependencies.</p>
<blockquote>
<p>Built on top of <a href="https://github.com/ihor-bielchenko/power-redis"><strong>PowerRedis</strong></a><br>
Uses utilities from <a href="https://github.com/ihor-bielchenko/full-utils"><strong>full-utils</strong></a></p>
</blockquote>
<h2 id="api-with-examples" class="tsd-anchor-link">API (with examples)<a href="#api-with-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Below are brief excerpts. Full JSDoc: <a href="http://power-queues.docs.ihor.bielchenko.com">power-queues.docs.ihor.bielchenko.com</a>.</p>
<h2 id="overview" class="tsd-anchor-link">Overview<a href="#overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>PowerQueue is not a ‚Äúready-made‚Äù message broker like BullMQ ‚Äî it‚Äôs a <strong>foundation</strong> for building your own<br>
custom Redis-based queues with full control over task lifecycle and execution flow.</p>
<p>It manages:</p>
<ul>
<li><code>LIST</code> for <strong>ready tasks</strong> (RPUSH producers, LMOVE/RPOPLPUSH consumers)</li>
<li><code>LIST</code> for <strong>processing tasks</strong> (temporary visibility list)</li>
<li><code>ZSET</code> for <strong>visibility timeouts</strong> (invisible tasks until acknowledged or expired)</li>
<li><code>ZSET</code> for <strong>delayed scheduling</strong> (future tasks activation)</li>
</ul>
<p>Ideal for:</p>
<ul>
<li>high-performance Redis-based backends,</li>
<li>telemetry and distributed job systems,</li>
<li>retryable or delayed workloads,</li>
<li>cron-like task promotion and requeueing.</li>
</ul>
<hr>
<h2 id="key-features" class="tsd-anchor-link">Key Features<a href="#key-features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><strong>Visibility timeout</strong> ‚Äî automatic requeue if worker crashes or fails to ack in time</li>
<li><strong>Delayed tasks</strong> ‚Äî schedule jobs for future execution (e.g., 5 minutes later)</li>
<li><strong>Concurrent processing</strong> ‚Äî process multiple jobs in parallel</li>
<li><strong>Retry logic</strong> ‚Äî exponential backoff with configurable limits</li>
<li><strong>Lifecycle hooks</strong> ‚Äî extend and customize every phase</li>
<li><strong>Task chaining</strong> ‚Äî forward results between queues</li>
<li><strong>Lua-optimized reservation</strong> ‚Äî atomic batch pulls via LMOVE or RPOPLPUSH fallback</li>
<li><strong>Zero dependencies</strong> ‚Äî built purely on Node.js + PowerRedis + full-utils</li>
</ul>
<h2 id="installation" class="tsd-anchor-link">Installation<a href="#installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">power-queue</span><br/><span class="hl-3"># or</span><br/><span class="hl-0">yarn</span><span class="hl-1"> </span><span class="hl-2">add</span><span class="hl-1"> </span><span class="hl-2">power-queue</span>
</code><button type="button">Copy</button></pre>

<p>PowerQueue works with any Redis client compatible with IORedis interface.</p>
<h2 id="example-usage" class="tsd-anchor-link">Example Usage<a href="#example-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="1-create-your-custom-queue" class="tsd-anchor-link">1. Create your custom queue<a href="#1-create-your-custom-queue" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-5">PowerQueue</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-2">&#39;power-queue&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">class</span><span class="hl-1"> </span><span class="hl-7">EmailQueue</span><span class="hl-1"> </span><span class="hl-6">extends</span><span class="hl-1"> </span><span class="hl-7">PowerQueue</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">/**</span><br/><span class="hl-3">   * Process a single task payload.</span><br/><span class="hl-3">   */</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">execute</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;üì® Sending email:&#39;</span><span class="hl-1">, </span><span class="hl-5">task</span><span class="hl-1">.</span><span class="hl-5">payload</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-3">// Simulate async work</span><br/><span class="hl-1">    </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-0">wait</span><span class="hl-1">(</span><span class="hl-8">200</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-3">// Optionally return result</span><br/><span class="hl-1">    </span><span class="hl-4">return</span><span class="hl-1"> { </span><span class="hl-5">status:</span><span class="hl-1"> </span><span class="hl-2">&#39;sent&#39;</span><span class="hl-1">, </span><span class="hl-5">timestamp:</span><span class="hl-1"> </span><span class="hl-5">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() };</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">export</span><span class="hl-1"> </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-9">emailQueue</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">EmailQueue</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">redis:</span><span class="hl-1"> { </span><span class="hl-5">host:</span><span class="hl-1"> </span><span class="hl-2">&#39;127.0.0.1&#39;</span><span class="hl-1">, </span><span class="hl-5">port:</span><span class="hl-1"> </span><span class="hl-8">6379</span><span class="hl-1"> },</span><br/><span class="hl-1">});</span><br/>
</code><button type="button">Copy</button></pre>

<h3 id="2-enqueue-a-new-task" class="tsd-anchor-link">2. Enqueue a new task<a href="#2-enqueue-a-new-task" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">emailQueue</span><span class="hl-1">.</span><span class="hl-0">enqueue</span><span class="hl-1">(</span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-5">to:</span><span class="hl-1"> </span><span class="hl-2">&#39;user@example.com&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">subject:</span><span class="hl-1"> </span><span class="hl-2">&#39;Welcome!&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">body:</span><span class="hl-1"> </span><span class="hl-2">&#39;Hello and thanks for joining!&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/>
</code><button type="button">Copy</button></pre>

<h3 id="3-start-processing" class="tsd-anchor-link">3. Start processing<a href="#3-start-processing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="javascript"><span class="hl-5">emailQueue</span><span class="hl-1">.</span><span class="hl-0">start</span><span class="hl-1">(</span><span class="hl-2">&#39;emails&#39;</span><span class="hl-1">);</span><br/>
</code><button type="button">Copy</button></pre>

<p>That‚Äôs it ‚Äî PowerQueue will:</p>
<ul>
<li>Pull tasks from Redis LIST atomically</li>
<li>Move them into processing + visibility sets</li>
<li>Retry or requeue on error or timeout</li>
<li>Handle parallel processing with full isolation</li>
</ul>
<h2 id="configuration-options" class="tsd-anchor-link">Configuration Options<a href="#configuration-options" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Each property is strongly typed and fully documented in TypeDoc.</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>iterationTimeout</code></td>
<td><code>number</code></td>
<td><code>1000</code></td>
<td>Delay (ms) between polling loops</td>
</tr>
<tr>
<td><code>portionLength</code></td>
<td><code>number</code></td>
<td><code>1000</code></td>
<td>Max number of tasks per batch pull</td>
</tr>
<tr>
<td><code>expireStatusSec</code></td>
<td><code>number</code></td>
<td><code>300</code></td>
<td>TTL for progress tracking</td>
</tr>
<tr>
<td><code>maxAttempts</code></td>
<td><code>number</code></td>
<td><code>1</code></td>
<td>Max retry attempts before marking as failed</td>
</tr>
<tr>
<td><code>concurrency</code></td>
<td><code>number</code></td>
<td><code>32</code></td>
<td>Parallel runners per queue</td>
</tr>
<tr>
<td><code>visibilityTimeoutSec</code></td>
<td><code>number</code></td>
<td><code>60</code></td>
<td>How long a task stays invisible before requeue</td>
</tr>
<tr>
<td><code>retryBaseSec</code></td>
<td><code>number</code></td>
<td><code>1</code></td>
<td>Base delay for exponential backoff</td>
</tr>
<tr>
<td><code>retryMaxSec</code></td>
<td><code>number</code></td>
<td><code>3600</code></td>
<td>Max retry delay</td>
</tr>
<tr>
<td><code>runners</code></td>
<td><code>Map&lt;string, { running: boolean }&gt;</code></td>
<td>‚Äî</td>
<td>Active queue execution flags</td>
</tr>
<tr>
<td><code>processingRaw</code></td>
<td><code>Map&lt;string, string&gt;</code></td>
<td>‚Äî</td>
<td>Tracks raw Redis entries for acknowledgment</td>
</tr>
<tr>
<td><code>heartbeatTimers</code></td>
<td><code>Map&lt;string, NodeJS.Timeout&gt;</code></td>
<td>‚Äî</td>
<td>Maintains active visibility extensions</td>
</tr>
</tbody>
</table>
<h2 id="design-principles" class="tsd-anchor-link">Design Principles<a href="#design-principles" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="minimalism" class="tsd-anchor-link">Minimalism<a href="#minimalism" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Only core Redis primitives are used ‚Äî no unnecessary abstractions or event emitters.</p>
<h3 id="predictability" class="tsd-anchor-link">Predictability<a href="#predictability" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>All queue state is transparent and Redis-inspectable:</p>
<ul>
<li><code>LIST</code> for ready and processing states</li>
<li><code>ZSET</code> for timeouts and scheduling</li>
</ul>
<h3 id="resilience" class="tsd-anchor-link">Resilience<a href="#resilience" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Every step (reserve, ack, retry, promote) can recover after process restart.</p>
<h3 id="extensibility" class="tsd-anchor-link">Extensibility<a href="#extensibility" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Implement custom behaviors by overriding:</p>
<pre><code class="javascript"><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">beforeExecute</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">) {}</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">afterExecute</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">, </span><span class="hl-5">result</span><span class="hl-1">) {}</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onError</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">, </span><span class="hl-5">error</span><span class="hl-1">) {}</span><br/><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">onRetry</span><span class="hl-1">(</span><span class="hl-5">task</span><span class="hl-1">, </span><span class="hl-5">delaySec</span><span class="hl-1">) {}</span>
</code><button type="button">Copy</button></pre>

<h2 id="license" class="tsd-anchor-link">License<a href="#license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Use freely in your own projects. Add proper notices if you publish a package (MIT/Apache-2.0, etc.).</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#power-queues"><span>power-<wbr/>queues</span></a><ul><li><a href="#api-with-examples"><span>API (with examples)</span></a></li><li><a href="#overview"><span>Overview</span></a></li><li><a href="#key-features"><span>Key <wbr/>Features</span></a></li><li><a href="#installation"><span>Installation</span></a></li><li><a href="#example-usage"><span>Example <wbr/>Usage</span></a></li><li><ul><li><a href="#1-create-your-custom-queue"><span>1. <wbr/>Create your custom queue</span></a></li><li><a href="#2-enqueue-a-new-task"><span>2. <wbr/>Enqueue a new task</span></a></li><li><a href="#3-start-processing"><span>3. <wbr/>Start processing</span></a></li></ul></li><li><a href="#configuration-options"><span>Configuration <wbr/>Options</span></a></li><li><a href="#design-principles"><span>Design <wbr/>Principles</span></a></li><li><ul><li><a href="#minimalism"><span>Minimalism</span></a></li><li><a href="#predictability"><span>Predictability</span></a></li><li><a href="#resilience"><span>Resilience</span></a></li><li><a href="#extensibility"><span>Extensibility</span></a></li></ul></li><li><a href="#license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">power-queues API Docs - v2.0.0</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
